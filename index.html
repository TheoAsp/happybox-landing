<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>my Happy Box â€” Kalavryta Edition</title>

<style>
  :root{
    --brand:#ff7a00; --brand-soft:#ffb84d;
    --bg1:#fef9f5; --bg2:#fff6eb; --ink:#333; --muted:#555; --ink2:#222;
    --ok:#1f9d55; --warn:#e2a61f; --err:#d33c3c;
  }
  *{box-sizing:border-box}
  body{ margin:0; font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:var(--ink); overflow-x:hidden; }

  /* header language switch */
  .topbar{ display:flex; justify-content:flex-end; align-items:center; gap:8px;
    padding:10px 16px; }
  .lang{ border:1px solid #eee; background:#fff; border-radius:10px; padding:8px 10px; cursor:pointer; }
  .lang select{ border:none; background:transparent; font-weight:600; }

  /* confetti bg */
  .confetti{ position:fixed; inset:0; pointer-events:none; opacity:.18;
    background:
      radial-gradient(circle at 10% 20%, #ff7a00 2px, transparent 3px) 0 0/120px 120px,
      radial-gradient(circle at 80% 30%, #ffb84d 2px, transparent 3px) 0 0/140px 140px,
      radial-gradient(circle at 30% 80%, #ffd699 2px, transparent 3px) 0 0/160px 160px;
    animation: floaty 14s linear infinite; }
  @keyframes floaty{from{transform:translateY(0)}to{transform:translateY(-120px)}}

  header{ text-align:center; padding:24px 20px 24px; animation:drop .8s ease forwards; }
  @keyframes drop{from{opacity:0; transform:translateY(-24px)}to{opacity:1; transform:translateY(0)}}

  .title{ margin:0; font-size:clamp(32px,6vw,56px); color:var(--brand);
    letter-spacing:.4px; display:flex; align-items:center; justify-content:center; gap:.35rem; }
  .title .my{ font-weight:700; font-size:.68em; color:#9a9a9a; margin-right:.15rem }
  .gift{ font-size:.9em; filter:drop-shadow(0 2px 2px rgba(0,0,0,.08)); }
  .edition{ margin:.25rem 0 0; font-size:clamp(14px,2.6vw,20px); color:var(--brand-soft);
    font-style:italic; display:inline-block; transform:rotate(-2deg);
    background:#fff; padding:6px 12px; border:1px dashed var(--brand-soft); border-radius:999px; }
  .sub{ margin:14px auto 0; max-width:940px; font-size:clamp(14px,2.1vw,18px);
    color:var(--muted); line-height:1.55; text-align:center; padding:0 16px; }

  /* Slider */
  .hero-wrap{ display:flex; justify-content:center; padding:22px 16px 10px; }
  .hero-frame{ width:min(1020px,90vw); height:clamp(260px,48vw,560px);
    background:#fff; border:10px solid #fff; border-radius:18px; box-shadow:0 12px 36px rgba(0,0,0,.14);
    position:relative; overflow:hidden; }
  .hero-img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain;
    background:#fff; transition:opacity .5s ease; }
  .badge{ position:absolute; top:10px; left:10px; background:rgba(255,255,255,.9);
    color:#444; font-size:12px; padding:4px 8px; border-radius:999px; backdrop-filter:blur(6px); }
  .nav{ position:absolute; top:50%; transform:translateY(-50%); width:42px; height:42px; border-radius:50%;
    background:rgba(255,255,255,.9); display:grid; place-items:center; box-shadow:0 4px 16px rgba(0,0,0,.15);
    cursor:pointer; user-select:none; } .nav:hover{ filter:brightness(1.03) }
  .nav.prev{ left:10px } .nav.next{ right:10px }

  /* Example */
  .example{ max-width:min(1020px,90vw); margin:26px auto 0; padding:18px 14px 8px;
    border-radius:18px; background:rgba(255,255,255,.65); box-shadow:0 8px 26px rgba(0,0,0,.08); }
  .example h4{ margin:0 0 10px 6px; font-size:13px; color:#666; font-weight:600; }
  .example-img{ display:block; width:100%; height:auto; border-radius:12px;
    background:#fff; border:10px solid #fff; box-shadow:0 8px 26px rgba(0,0,0,.08); }

  /* Quests */
  .quests{ max-width:min(1060px,92vw); margin:32px auto; padding:6px; }
  .card{ background:#fff; border-radius:14px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.08); margin-bottom:14px; }
  .card h3{ margin:4px 0 6px; font-size:20px } .card p{ margin:0 0 12px; color:#666 }
  .row{ display:flex; gap:8px; align-items:center; margin:8px 0; flex-wrap:wrap }
  .row input[type="text"]{ flex:1; min-width:260px; padding:10px 12px; border:1px solid #e6e6e6; border-radius:10px; font-size:15px; }
  .btn{ appearance:none; border:none; cursor:pointer; color:#fff; background:var(--brand);
    padding:10px 14px; border-radius:10px; font-weight:700; box-shadow:0 8px 20px rgba(255,122,0,.3); }
  .btn.alt{ background:#444 } .btn.ghost{ background:#fff; color:#333; border:1px solid #ddd }
  .pill{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:13px; font-weight:600; margin:3px 6px 0 0 }
  .ok{ background:#eaf7f0; color:var(--ok) } .warn{ background:#fff6e0; color:var(--warn) } .err{ background:#fdecec; color:var(--err) }
  .status{ margin-top:6px; font-size:14px; color:#666 }

  /* Stage tracker (top of quests) */
  .stage{ display:flex; align-items:center; gap:12px; margin:10px 0 6px }
  .step{ display:flex; align-items:center; gap:8px; color:#666; }
  .dot{ width:22px; height:22px; border-radius:50%; border:2px solid #ddd; display:grid; place-items:center; font-size:12px; background:#fff }
  .step.done .dot{ border-color:var(--ok); background:#eaf7f0; color:var(--ok) }
  .bar{ flex:1; height:4px; background:#eee; border-radius:999px; position:relative; overflow:hidden }
  .bar > span{ position:absolute; inset:0 0 0 auto; width:0%; background:linear-gradient(90deg,#27c498,#ffb84d); transition:width .4s ease }
  .sublabel{ font-size:12px; color:#888 }

  /* Overall progress bar */
  .overall{ display:flex; align-items:center; gap:12px; }
  .overall .meter{ flex:1; height:10px; background:#eee; border-radius:999px; overflow:hidden; }
  .overall .meter > span{ display:block; height:100%; width:0%; background:linear-gradient(90deg,#1f9d55,#ff7a00); transition:width .35s ease; }
  .overall .pct{ min-width:42px; font-weight:700; color:#444 }

  /* CTA */
  .cta{ text-align:center; padding:42px 20px 70px }
  .cta h2{ margin:0 0 10px; font-size:clamp(20px,4vw,28px); color:var(--ink2) }
  .cta p{ margin:0 0 16px; color:#muted }

  footer{ text-align:center; padding:18px; color:#999; font-size:13px }

  /* Modal */
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:50; }
  .modal.show{ display:flex }
  .modal-card{ background:#fff; border-radius:16px; padding:26px 28px; box-shadow:0 20px 60px rgba(0,0,0,.25);
    text-align:center; min-width:min(90vw,520px); }
  .modal-card h3{ margin:0 0 10px }
  .modal-card p{ margin:0 0 10px; color:#555 }
  .modal-card .mini{ font-size:12px; color:#777; margin-top:4px }
  .close{ border:none; background:#eee; border-radius:10px; padding:10px 16px; cursor:pointer; }
  .disabled{ opacity:.55; cursor:not-allowed }
</style>
</head>
<body>
  <div class="confetti" aria-hidden="true"></div>

  <!-- Language switch -->
  <div class="topbar">
    <div class="lang">
      <label for="langSel" style="margin-right:6px; color:#666; font-size:13px;" data-i18n="ui.languageLabel">Language</label>
      <select id="langSel" aria-label="Language">
        <option value="en">English</option>
        <option value="el">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</option>
      </select>
    </div>
  </div>

  <header>
    <h1 class="title"><span class="my">my</span> Happy Box <span class="gift">ğŸ</span></h1>
    <div class="edition" data-i18n="hero.edition">Kalavryta Edition</div>
    <p class="sub" data-i18n-html="hero.sub">
      A joyful mini-game for travelers! Complete quests around Kalavryta to level-up your reward.  
      Unlock one of <strong>1,000 limited-edition NFT photos</strong> â€” the rarer your tier, the rarer your art.
      Have fun, explore, win surprises!
    </p>
  </header>

  <!-- Slider -->
  <section class="hero-wrap">
    <div class="hero-frame" id="heroFrame">
      <div class="badge" data-i18n="slider.badge">Kalavryta preview</div>
      <img id="heroImg" class="hero-img" src="public/photos/2.png" alt="Kalavryta preview" />
      <div class="nav prev" id="prevBtn" aria-label="Previous">â€¹</div>
      <div class="nav next" id="nextBtn" aria-label="Next">â€º</div>
    </div>
  </section>

  <!-- Bundle example -->
  <section class="example">
    <h4 data-i18n="bundle.title">Bundle example</h4>
    <img class="example-img" src="public/photos/1.png" alt="Bundle Minted example" />
  </section>

  <!-- ===== GAME / QUESTS ===== -->
  <section class="quests">
    <!-- Stage tracker -->
    <div class="card" id="stageCard">
      <h3><span data-i18n="stage.title">Stage</span> <span id="stageNum">1</span> â€” <span data-i18n="stage.subtitle">Play to unlock the next!</span></h3>
      <div class="stage">
        <div class="step" id="stStep1"><div class="dot">1</div><div data-i18n="stage.s1">Stage 1</div></div>
        <div class="bar"><span id="barFill"></span></div>
        <div class="step" id="stStep2"><div class="dot">2</div><div data-i18n="stage.s2">Stage 2</div></div>
        <div class="bar" style="max-width:120px"><span></span></div>
        <div class="step" id="stStep3"><div class="dot">3</div><div data-i18n="stage.s3">Stage 3</div></div>
      </div>
      <div class="sublabel" id="stageHint" data-i18n="stage.hint1">Finish Stage 1 to unlock Stage 2 â€” and aim for rarer tiers.</div>
    </div>

    <!-- Stage 1 card -->
    <div class="card" id="s1Card">
      <h3 data-i18n="s1.title">Stage 1 â€” Warm-up (ğŸ¯ complete 3/3)</h3>
      <p data-i18n="s1.desc">Pick your path â€” you need: 1 social + 1 shop + 1 of the sights.</p>

      <!-- Social -->
      <div class="row"><span data-i18n="s1.socialLabel">ğŸ“¸ Post with hashtag #myhappybox</span></div>
      <div class="row">
        <input type="text" id="s1PostUrl" placeholder="Public post URL (e.g. Instagram)">
        <button class="btn" id="s1PostBtn" data-i18n="ui.submitLink">Submit link</button>
      </div>
      <div class="status" id="s1PostStatus"></div>

      <!-- Shop (1) -->
      <div class="row" style="margin-top:10px"><span data-i18n="s1.shopLabel">ğŸª Partner Shop (Stage 1)</span></div>
      <div class="row">
        <input type="text" id="s1Qr" data-i18n-ph="ui.enterQr">
        <button class="btn" id="s1QrBtn" data-i18n="ui.verifyQr">Verify QR</button>
      </div>
      <div class="status" id="s1QrStatus"></div>

      <!-- Sights (choose one) -->
      <div class="row" style="margin-top:10px"><span data-i18n="s1.sightsLabel">ğŸ—ºï¸ Visit one: </span></div>
      <div class="row">
        <label><input type="checkbox" id="s1SightA"> <span data-i18n="s1.sightA">Agia Lavra â›ª</span></label>
        <label><input type="checkbox" id="s1SightB"> <span data-i18n="s1.sightB">Mega Spilaio Monastery ğŸ•</span></label>
        <button class="btn ghost" id="s1SightBtn" data-i18n="ui.markVisited">Mark visited</button>
      </div>
      <div class="status" id="s1SightStatus"></div>
    </div>

    <!-- Stage 2 card (unlocks) -->
    <div class="card" id="s2Card">
      <h3 data-i18n="s2.title">Stage 2 â€” Explore more (ğŸ¯ complete 3/3)</h3>
      <p data-i18n="s2.desc">Requires Stage 1 complete. You need: 2 shops + 1 of (Hill geo âœ” OR rack-railway photo).</p>

      <!-- Shops (2) -->
      <div class="row"><span data-i18n="s2.shopsLabel">ğŸª Partner Shops (Stage 2)</span></div>
      <div class="row">
        <input type="text" id="s2QrA" data-i18n-ph="s2.qrA">
        <input type="text" id="s2QrB" data-i18n-ph="s2.qrB">
        <button class="btn" id="s2QrBtn" data-i18n="s2.verifyBoth">Verify both</button>
      </div>
      <div class="status" id="s2QrStatus"></div>

      <!-- Geo OR Photo -->
      <div class="row" style="margin-top:10px"><span data-i18n="s2.altLabel">ğŸ§­ One of: Hill of Kapi (geo) OR Rack-Railway photo URL</span></div>
      <div class="row">
        <button class="btn" id="s2GeoBtn" data-i18n="s2.geoBtn">Iâ€™m at the Hill of Kapi</button>
        <input type="text" id="s2RailUrl" data-i18n-ph="s2.railPh">
        <button class="btn ghost" id="s2RailBtn" data-i18n="ui.submitUrl">Submit URL</button>
      </div>
      <div class="status" id="s2GeoStatus"></div>
    </div>

    <!-- Stage 3 card (final) -->
    <div class="card" id="s3Card">
      <h3 data-i18n="s3.title">Stage 3 â€” The finale (ğŸ¯ complete 3/3)</h3>
      <p data-i18n="s3.desc">Requires Stage 2 complete. You need: 3 shop scans.</p>

      <div class="row"><span data-i18n="s3.shopsLabel">ğŸª Partner Shops (Stage 3)</span></div>
      <div class="row">
        <input type="text" id="s3QrA" data-i18n-ph="s3.qrA">
        <input type="text" id="s3QrB" data-i18n-ph="s3.qrB">
        <input type="text" id="s3QrC" data-i18n-ph="s3.qrC">
        <button class="btn" id="s3QrBtn" data-i18n="s3.verifyAll">Verify all</button>
      </div>
      <div class="status" id="s3QrStatus"></div>
    </div>

    <!-- Progress & Tier -->
    <div class="card" id="progressCard">
      <h3 data-i18n="progress.title">Your Progress</h3>
      <!-- Overall progress bar -->
      <div class="overall" style="margin:8px 0 10px">
        <div class="meter"><span id="overallFill"></span></div>
        <div class="pct" id="overallPct">0%</div>
      </div>

      <div id="progressPills" class="row" style="flex-wrap:wrap"></div>
      <p class="status" id="tierLine">Tier: â€”</p>
      <div class="row">
        <button class="btn alt" id="resetBtn" data-i18n="ui.reset">Reset demo</button>
        <button class="btn" id="claimBtn" data-i18n="ui.claim">ğŸ Claim your Happy Box</button>
      </div>
      <p class="status" data-i18n="progress.claimInfo">Claim becomes available once you complete <strong>Stage 1</strong>. You can keep playing for rarer tiers!</p>
    </div>
  </section>

  <section class="cta">
    <h2 data-i18n="cta.title">Explore â€¢ Play â€¢ Win</h2>
    <p data-i18n="cta.desc">Itâ€™s a friendly treasure-hunt across Kalavryta. Finish Stage 1 to unlock Stage 2 and go for rarer rewards!</p>
    <button id="mintInfoBtn" class="btn" data-i18n="ui.howClaiming">How claiming works</button>
  </section>

  <footer>Â© 2025 Happy Box. All rights reserved.</footer>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-card">
      <h3 id="modalTitle">Claiming</h3>
      <div id="modalBody"></div>
      <p class="mini" data-i18n="modal.mini">Your tier is calculated automatically from your completed quests.</p>
      <button class="close" id="closeModal" data-i18n="ui.close">Close</button>
    </div>
  </div>

<script>
/* ================== i18n ================== */
const I18N = {
  en: {
    "ui.languageLabel":"Language",
    "hero.edition":"Kalavryta Edition",
    "hero.sub":"A joyful mini-game for travelers! Complete quests around Kalavryta to level-up your reward.  <br>Unlock one of <strong>1,000 limited-edition NFT photos</strong> â€” the rarer your tier, the rarer your art.  <br>Have fun, explore, win surprises!",
    "slider.badge":"Kalavryta preview",
    "bundle.title":"Bundle example",

    "stage.title":"Stage",
    "stage.subtitle":"Play to unlock the next!",
    "stage.s1":"Stage 1",
    "stage.s2":"Stage 2",
    "stage.s3":"Stage 3",
    "stage.hint1":"Finish Stage 1 to unlock Stage 2 â€” and aim for rarer tiers.",
    "stage.hint2":"Great! Stage 2 unlocked â€” complete it to reach Stage 3.",
    "stage.hint3":"Final stretch! Complete Stage 3 for the top tier.",

    "s1.title":"Stage 1 â€” Warm-up (ğŸ¯ complete 3/3)",
    "s1.desc":"Pick your path â€” you need: 1 social + 1 shop + 1 of the sights.",
    "s1.socialLabel":"ğŸ“¸ Post with hashtag #myhappybox",
    "s1.shopLabel":"ğŸª Partner Shop (Stage 1)",
    "s1.sightsLabel":"ğŸ—ºï¸ Visit one:",
    "s1.sightA":"Agia Lavra â›ª",
    "s1.sightB":"Mega Spilaio Monastery ğŸ•",

    "s2.title":"Stage 2 â€” Explore more (ğŸ¯ complete 3/3)",
    "s2.desc":"Requires Stage 1 complete. You need: 2 shops + 1 of (Hill geo âœ” OR rack-railway photo).",
    "s2.shopsLabel":"ğŸª Partner Shops (Stage 2)",
    "s2.qrA":"Enter QR code for Shop 2A",
    "s2.qrB":"Enter QR code for Shop 2B",
    "s2.verifyBoth":"Verify both",
    "s2.altLabel":"ğŸ§­ One of: Hill of Kapi (geo) OR Rack-Railway photo URL",
    "s2.geoBtn":"Iâ€™m at the Hill of Kapi",
    "s2.railPh":"Public photo URL of Odontotos",

    "s3.title":"Stage 3 â€” The finale (ğŸ¯ complete 3/3)",
    "s3.desc":"Requires Stage 2 complete. You need: 3 shop scans.",
    "s3.shopsLabel":"ğŸª Partner Shops (Stage 3)",
    "s3.qrA":"QR for Shop 3A",
    "s3.qrB":"QR for Shop 3B",
    "s3.qrC":"QR for Shop 3C",
    "s3.verifyAll":"Verify all",

    "progress.title":"Your Progress",
    "progress.claimInfo":"Claim becomes available once you complete <strong>Stage 1</strong>. You can keep playing for rarer tiers!",

    "cta.title":"Explore â€¢ Play â€¢ Win",
    "cta.desc":"Itâ€™s a friendly treasure-hunt across Kalavryta. Finish Stage 1 to unlock Stage 2 and go for rarer rewards!",

    "ui.submitLink":"Submit link",
    "ui.enterQr":"Enter QR code (placeholder)",
    "ui.verifyQr":"Verify QR",
    "ui.markVisited":"Mark visited",
    "ui.submitUrl":"Submit URL",
    "ui.reset":"Reset demo",
    "ui.claim":"ğŸ Claim your Happy Box",
    "ui.howClaiming":"How claiming works",
    "ui.close":"Close",

    "modal.lockedTitle":"Claiming",
    "modal.lockedBody":"To claim your gift, please complete <strong>Stage 1</strong> first:<ul style='text-align:left;line-height:1.5'><li>ğŸ“¸ Make a public post (#myhappybox)</li><li>ğŸª Scan one partner shop QR</li><li>ğŸ—ºï¸ Visit one sight (Agia Lavra or Mega Spilaio)</li></ul><p>Once done, you can claim a <strong>Common / Uncommon</strong> NFT â€” or keep playing for rarer tiers.</p>",
    "modal.unlockedTitle":"Claiming",
    "modal.unlockedBody":"Nice! Youâ€™ve unlocked claiming. You can mint a <strong>{tier}</strong> NFT based on your progress. Continue to Stage 2 & 3 for <strong>Rare / Ultra Rare / Legendary</strong> rewards â€” or claim now.<p class='mini'>In production, this button would open the secure mint flow or a QR at reception.</p>",

    "toast.validUrl":"Paste a valid public URL",
    "toast.hashtag":"Make sure your post includes #myhappybox",
    "toast.enterCode":"Enter code",
    "toast.pickOne":"Pick at least one",
    "toast.stage1First":"Complete Stage 1 first",
    "toast.stage2First":"Complete Stage 2 first",
    "toast.okSubmitted":"Submitted",
    "toast.okVerified":"Verified",
    "toast.okBoth":"Both verified",
    "toast.geoUnsupported":"Geolocation not supported",
    "toast.geoFar":"You seem too far (~{km} km)",
    "toast.geoOk":"Location verified"
  },
  el: {
    "ui.languageLabel":"Î“Î»ÏÏƒÏƒÎ±",
    "hero.edition":"ÎˆÎºÎ´Î¿ÏƒÎ· ÎšÎ±Î»Î¬Î²ÏÏ…Ï„Î±",
    "hero.sub":"ÎˆÎ½Î± Ï‡Î±ÏÎ¿ÏÎ¼ÎµÎ½Î¿ mini-game Î³Î¹Î± Ï„Î±Î¾Î¹Î´Î¹ÏÏ„ÎµÏ‚! ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î­Ï‚ ÏƒÏ„Î± ÎšÎ±Î»Î¬Î²ÏÏ…Ï„Î± ÎºÎ±Î¹ Î±Î½Î­Î²Î±ÏƒÎµ Ï„Î¿ Î­Ï€Î±Î¸Î»ÏŒ ÏƒÎ¿Ï…. <br>ÎÎµÎºÎ»ÎµÎ¯Î´Ï‰ÏƒÎµ Î­Î½Î± Î±Ï€ÏŒ Ï„Î± <strong>1.000 ÏƒÏ…Î»Î»ÎµÎºÏ„Î¹ÎºÎ¬ NFT</strong> â€” ÏŒÏƒÎ¿ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ Ï„Î¿ tier, Ï„ÏŒÏƒÎ¿ Ï€Î¹Î¿ ÏƒÏ€Î¬Î½Î¹Î¿ Ï„Î¿ Î­ÏÎ³Î¿. <br>Î”Î¹Î±ÏƒÎºÎ­Î´Î±ÏƒÎµ, ÎµÎ¾ÎµÏÎµÏÎ½Î·ÏƒÎµ, ÎºÎ­ÏÎ´Î¹ÏƒÎµ ÎµÎºÏ€Î»Î®Î¾ÎµÎ¹Ï‚!",
    "slider.badge":"Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· ÎšÎ±Î»Î±Î²ÏÏÏ„Ï‰Î½",
    "bundle.title":"Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Bundle",

    "stage.title":"Î£Ï„Î¬Î´Î¹Î¿",
    "stage.subtitle":"Î Î±Î¯Î¾Îµ Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ»ÎµÎ¹Î´ÏÏƒÎµÎ¹Ï‚ Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿!",
    "stage.s1":"Î£Ï„Î¬Î´Î¹Î¿ 1",
    "stage.s2":"Î£Ï„Î¬Î´Î¹Î¿ 2",
    "stage.s3":"Î£Ï„Î¬Î´Î¹Î¿ 3",
    "stage.hint1":"ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ Ï„Î¿ Î£Ï„Î¬Î´Î¹Î¿ 1 Î³Î¹Î± Î½Î± Î±Î½Î¿Î¯Î¾ÎµÎ¹ Ï„Î¿ Î£Ï„Î¬Î´Î¹Î¿ 2 â€” ÏƒÏ„ÏŒÏ‡ÎµÏ…ÏƒÎµ ÏƒÎµ Ï€Î¹Î¿ ÏƒÏ€Î¬Î½Î¹Î± tiers.",
    "stage.hint2":"Î¤Î­Î»ÎµÎ¹Î±! Î¤Î¿ Î£Ï„Î¬Î´Î¹Î¿ 2 Î¬Î½Î¿Î¹Î¾Îµ â€” Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ­ Ï„Î¿ Î³Î¹Î± Î½Î± Ï†Ï„Î¬ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ Î£Ï„Î¬Î´Î¹Î¿ 3.",
    "stage.hint3":"Î¤ÎµÎ»Î¹ÎºÎ® ÎµÏ…Î¸ÎµÎ¯Î±! ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ Ï„Î¿ Î£Ï„Î¬Î´Î¹Î¿ 3 Î³Î¹Î± Ï„Î¿ ÎºÎ¿ÏÏ…Ï†Î±Î¯Î¿ tier.",

    "s1.title":"Î£Ï„Î¬Î´Î¹Î¿ 1 â€” Î–Î­ÏƒÏ„Î±Î¼Î± (ğŸ¯ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ 3/3)",
    "s1.desc":"Î”Î¹Î¬Î»ÎµÎ¾Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î® â€” Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÎ±Î¹: 1 social + 1 ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± + 1 Î±Ï€ÏŒ Ï„Î± ÏƒÎ·Î¼ÎµÎ¯Î±.",
    "s1.socialLabel":"ğŸ“¸ Î‘Î½Î­Î²Î±ÏƒÎµ post Î¼Îµ #myhappybox",
    "s1.shopLabel":"ğŸª Î£Ï…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î¿ ÎºÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± (Î£Ï„Î¬Î´Î¹Î¿ 1)",
    "s1.sightsLabel":"ğŸ—ºï¸ Î•Ï€Î¯ÏƒÎºÎµÏˆÎ· ÏƒÎµ Î­Î½Î±:",
    "s1.sightA":"Î‘Î³Î¯Î± Î›Î±ÏÏÎ± â›ª",
    "s1.sightB":"ÎœÎ­Î³Î± Î£Ï€Î®Î»Î±Î¹Î¿ ğŸ•",

    "s2.title":"Î£Ï„Î¬Î´Î¹Î¿ 2 â€” Î•Î¾ÎµÏÎµÏÎ½Î·ÏƒÎµ (ğŸ¯ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ 3/3)",
    "s2.desc":"Î‘Ï€Î±Î¹Ï„ÎµÎ¯ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Î£Ï„Î±Î´Î¯Î¿Ï… 1. Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÎ±Î¹: 2 ÎºÎ±Ï„Î±ÏƒÏ„Î®Î¼Î±Ï„Î± + 1 Î±Ï€ÏŒ (Î›ÏŒÏ†Î¿Ï‚ ÎšÎ±Ï€Î¹ geo âœ” Î® Ï†Ï‰Ï„ÏŒ ÎŸÎ´Î¿Î½Ï„Ï‰Ï„Î¿Ï).",
    "s2.shopsLabel":"ğŸª Î£Ï…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î± ÎºÎ±Ï„Î±ÏƒÏ„Î®Î¼Î±Ï„Î± (Î£Ï„Î¬Î´Î¹Î¿ 2)",
    "s2.qrA":"ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ QR ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± 2Î‘",
    "s2.qrB":"ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ QR ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± 2Î’",
    "s2.verifyBoth":"Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· ÎºÎ±Î¹ Ï„Ï‰Î½ Î´ÏÎ¿",
    "s2.altLabel":"ğŸ§­ ÎˆÎ½Î± Î±Ï€ÏŒ: Î›ÏŒÏ†Î¿Ï‚ Ï„Î¿Ï… ÎšÎ±Ï€Î¹ (geo) Î® URL Ï†Ï‰Ï„ÏŒ ÎŸÎ´Î¿Î½Ï„Ï‰Ï„Î¿Ï",
    "s2.geoBtn":"Î•Î¯Î¼Î±Î¹ ÏƒÏ„Î¿Î½ Î›ÏŒÏ†Î¿ Ï„Î¿Ï… ÎšÎ±Ï€Î¹",
    "s2.railPh":"Î”Î·Î¼ÏŒÏƒÎ¹Î¿ URL Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚ ÎŸÎ´Î¿Î½Ï„Ï‰Ï„Î¿Ï",

    "s3.title":"Î£Ï„Î¬Î´Î¹Î¿ 3 â€” Î¤ÎµÎ»Î¹ÎºÏŒ (ğŸ¯ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ 3/3)",
    "s3.desc":"Î‘Ï€Î±Î¹Ï„ÎµÎ¯ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Î£Ï„Î±Î´Î¯Î¿Ï… 2. Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÎ±Î¹: 3 QR ÎºÎ±Ï„Î±ÏƒÏ„Î·Î¼Î¬Ï„Ï‰Î½.",
    "s3.shopsLabel":"ğŸª Î£Ï…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î± ÎºÎ±Ï„Î±ÏƒÏ„Î®Î¼Î±Ï„Î± (Î£Ï„Î¬Î´Î¹Î¿ 3)",
    "s3.qrA":"QR ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± 3Î‘",
    "s3.qrB":"QR ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± 3Î’",
    "s3.qrC":"QR ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± 3Î“",
    "s3.verifyAll":"Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· ÏŒÎ»Ï‰Î½",

    "progress.title":"Î— Ï€ÏÏŒÎ¿Î´ÏŒÏ‚ ÏƒÎ¿Ï…",
    "progress.claimInfo":"Î¤Î¿ claim Î³Î¯Î½ÎµÏ„Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î¼ÏŒÎ»Î¹Ï‚ Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÎ¹Ï‚ Ï„Î¿ <strong>Î£Ï„Î¬Î´Î¹Î¿ 1</strong>. Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ Î³Î¹Î± ÏƒÏ€Î±Î½Î¹ÏŒÏ„ÎµÏÎ± tiers!",

    "cta.title":"Î•Î¾ÎµÏÎµÏÎ½Î·ÏƒÎ· â€¢ Î Î±Î¹Ï‡Î½Î¯Î´Î¹ â€¢ ÎˆÏ€Î±Î¸Î»Î±",
    "cta.desc":"ÎˆÎ½Î± Ï†Î¹Î»Î¹ÎºÏŒ ÎºÏ…Î½Î®Î³Î¹ Î¸Î·ÏƒÎ±Ï…ÏÎ¿Ï ÏƒÏ„Î± ÎšÎ±Î»Î¬Î²ÏÏ…Ï„Î±. Î¤ÎµÎ»ÎµÎ¯Ï‰ÏƒÎµ Ï„Î¿ Î£Ï„Î¬Î´Î¹Î¿ 1 Î³Î¹Î± Î½Î± Î±Î½Î¿Î¯Î¾ÎµÎ¹ Ï„Î¿ Î£Ï„Î¬Î´Î¹Î¿ 2 ÎºÎ±Î¹ ÎºÏ…Î½Î®Î³Î·ÏƒÎµ ÏƒÏ€Î±Î½Î¹ÏŒÏ„ÎµÏÎ± Î­Ï€Î±Î¸Î»Î±!",

    "ui.submitLink":"Î¥Ï€Î¿Î²Î¿Î»Î® ÏƒÏ…Î½Î´Î­ÏƒÎ¼Î¿Ï…",
    "ui.enterQr":"Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ ÎºÏ‰Î´Î¹ÎºÏŒ QR (Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ„Î¹ÎºÏŒ)",
    "ui.verifyQr":"Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· QR",
    "ui.markVisited":"Î£Î®Î¼Î±Î½ÏƒÎ· ÎµÏ€Î¯ÏƒÎºÎµÏˆÎ·Ï‚",
    "ui.submitUrl":"Î¥Ï€Î¿Î²Î¿Î»Î® URL",
    "ui.reset":"Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ demo",
    "ui.claim":"ğŸ Î–Î®Ï„Î± Ï„Î¿ Happy Box ÏƒÎ¿Ï…",
    "ui.howClaiming":"Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ claim",
    "ui.close":"ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿",

    "modal.lockedTitle":"Claim",
    "modal.lockedBody":"Î“Î¹Î± Î½Î± Ï€Î±ÏÎ±Î»Î¬Î²ÎµÎ¹Ï‚ Ï„Î¿ Î´ÏÏÎ¿ ÏƒÎ¿Ï…, Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ Ï€ÏÏÏ„Î± Ï„Î¿ <strong>Î£Ï„Î¬Î´Î¹Î¿ 1</strong>:<ul style='text-align:left;line-height:1.5'><li>ğŸ“¸ Î”Î·Î¼ÏŒÏƒÎ¹Î¿ post Î¼Îµ #myhappybox</li><li>ğŸª Î£ÎºÎ¬Î½Î±ÏÎµ Î­Î½Î± QR ÏƒÏ…Î½ÎµÏÎ³Î¬Ï„Î·</li><li>ğŸ—ºï¸ Î•Ï€Î¯ÏƒÎºÎµÏˆÎ· ÏƒÎµ Î­Î½Î± ÏƒÎ·Î¼ÎµÎ¯Î¿ (Î‘Î³Î¯Î± Î›Î±ÏÏÎ± Î® ÎœÎ­Î³Î± Î£Ï€Î®Î»Î±Î¹Î¿)</li></ul><p>ÎœÎµÏ„Î¬ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ claim Î­Î½Î± <strong>Common / Uncommon</strong> NFT â€” Î® Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹Ï‚ Î³Î¹Î± ÏƒÏ€Î±Î½Î¹ÏŒÏ„ÎµÏÎ± tiers.</p>",
    "modal.unlockedTitle":"Claim",
    "modal.unlockedBody":"Î¥Ï€Î­ÏÎ¿Ï‡Î±! ÎÎµÎºÎ»ÎµÎ¯Î´Ï‰ÏƒÎµÏ‚ Ï„Î¿ claim. ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ mint Î­Î½Î± <strong>{tier}</strong> NFT Î²Î¬ÏƒÎµÎ¹ Ï€ÏÎ¿ÏŒÎ´Î¿Ï…. Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ ÏƒÏ„Î± Î£Ï„Î¬Î´Î¹Î± 2 & 3 Î³Î¹Î± <strong>Rare / Ultra Rare / Legendary</strong> â€” Î® ÎºÎ¬Î½Îµ claim Ï„ÏÏÎ±.<p class='mini'>Î£Ï„Î·Î½ Ï€Î±ÏÎ±Î³Ï‰Î³Î®, Î±Ï…Ï„ÏŒ Î¸Î± Î¬Î½Î¿Î¹Î³Îµ Ï„Î·Î½ Î±ÏƒÏ†Î±Î»Î® ÏÎ¿Î® mint Î® QR ÏƒÏ„Î· ÏÎµÏƒÎµÏˆÎ¹ÏŒÎ½.</p>",

    "toast.validUrl":"Î•Ï€Î¹ÎºÏŒÎ»Î»Î·ÏƒÎµ Î­Î³ÎºÏ…ÏÎ¿ Î´Î·Î¼ÏŒÏƒÎ¹Î¿ URL",
    "toast.hashtag":"Î’ÎµÎ²Î±Î¹ÏÏƒÎ¿Ï… ÏŒÏ„Î¹ Ï„Î¿ post Î­Ï‡ÎµÎ¹ #myhappybox",
    "toast.enterCode":"Î•Î¹ÏƒÎ®Î³Î±Î³Îµ ÎºÏ‰Î´Î¹ÎºÏŒ",
    "toast.pickOne":"Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î­Î½Î±",
    "toast.stage1First":"ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ Ï€ÏÏÏ„Î± Ï„Î¿ Î£Ï„Î¬Î´Î¹Î¿ 1",
    "toast.stage2First":"ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµ Ï€ÏÏÏ„Î± Ï„Î¿ Î£Ï„Î¬Î´Î¹Î¿ 2",
    "toast.okSubmitted":"Î¥Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ",
    "toast.okVerified":"Î•Ï€Î¹Î²ÎµÎ²Î±Î¹ÏÎ¸Î·ÎºÎµ",
    "toast.okBoth":"Î•Ï€Î¹Î²ÎµÎ²Î±Î¹ÏÎ¸Î·ÎºÎ±Î½ ÎºÎ±Î¹ Ï„Î± Î´ÏÎ¿",
    "toast.geoUnsupported":"Î”ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î³ÎµÏ‰ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚",
    "toast.geoFar":"Î¦Î±Î¯Î½ÎµÏƒÎ±Î¹ Î¼Î±ÎºÏÎ¹Î¬ (~{km} km)",
    "toast.geoOk":"Î— Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÎ¸Î·ÎºÎµ"
  }
};

const LANG_KEY='hb_lang';
function getLang(){ return localStorage.getItem(LANG_KEY) || (navigator.language||'en').slice(0,2).toLowerCase().startsWith('el') ? 'el' : 'en'; }
function setLang(l){ localStorage.setItem(LANG_KEY,l); applyLang(l); }
function t(lang, key){ return (I18N[lang] && I18N[lang][key]) || I18N.en[key] || key; }
function applyLang(lang){
  // textContent targets
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    el.textContent = t(lang, el.getAttribute('data-i18n'));
  });
  // innerHTML targets
  document.querySelectorAll('[data-i18n-html]').forEach(el=>{
    el.innerHTML = t(lang, el.getAttribute('data-i18n-html'));
  });
  // placeholders
  document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
    const key = el.getAttribute('data-i18n-ph');
    el.placeholder = t(lang, key);
  });

  // Stage hint swap based on current stage later in render()
  render(); // re-render to update hint lines with correct language
}

const langSel=document.getElementById('langSel');
langSel.value=getLang();
langSel.addEventListener('change', e=>setLang(e.target.value));

/* ================== helpers & store ================== */
const LS_KEY='hb_demo_progress_v2';
function loadStore(){ try{return JSON.parse(localStorage.getItem(LS_KEY)||'{}')}catch(e){return{}} }
function saveStore(o){ localStorage.setItem(LS_KEY, JSON.stringify(o||{})) }
function clearStore(){ localStorage.removeItem(LS_KEY) }
function addDone(key){ const s=loadStore(); s.completed=Array.from(new Set([...(s.completed||[]), key])); saveStore(s); }

/* ================== slider (2..27) ================== */
const slides=Array.from({length:26},(_,i)=>`public/photos/${i+2}.png`);
let sIdx=0, timer; const heroImg=document.getElementById('heroImg'), frame=document.getElementById('heroFrame');
function show(n){ sIdx=(n+slides.length)%slides.length; heroImg.style.opacity=0;
  setTimeout(()=>{ heroImg.src=slides[sIdx]; heroImg.onload=()=>heroImg.style.opacity=1; },180); }
function start(){ timer=setInterval(()=>show(sIdx+1),4000) } function stop(){ clearInterval(timer) }
document.getElementById('prevBtn').onclick=()=>{stop();show(sIdx-1);start()};
document.getElementById('nextBtn').onclick=()=>{stop();show(sIdx+1);start()};
frame.onmouseenter=stop; frame.onmouseleave=start; show(0); start();

/* ================== stage / completion model ==================
 Stage 1 needs 3/3:
   - s1:post
   - s1:shop
   - one of (s1:sightA, s1:sightB)
 Stage 2 needs 3/3 (unlocks when Stage 1 ok):
   - s2:shopA
   - s2:shopB
   - one of (s2:geo, s2:rail)
 Stage 3 needs 3/3 (unlocks when Stage 2 ok):
   - s3:shopA, s3:shopB, s3:shopC
 Overall progress bar counts minimal required tasks (3 + 3 + 3 = 9)
===================================================== */
function getState(){
  const done=new Set((loadStore().completed)||[]);
  const s1 = { post: done.has('s1:post'), shop: done.has('s1:shop'), sight: (done.has('s1:sightA') || done.has('s1:sightB')) };
  const s1ok = s1.post && s1.shop && s1.sight;

  const s2 = { shopA: done.has('s2:shopA'), shopB: done.has('s2:shopB'), alt: (done.has('s2:geo') || done.has('s2:rail')) };
  const s2ok = s1ok && s2.shopA && s2.shopB && s2.alt;

  const s3 = { shopA: done.has('s3:shopA'), shopB: done.has('s3:shopB'), shopC: done.has('s3:shopC') };
  const s3ok = s2ok && s3.shopA && s3.shopB && s3.shopC;

  const overallCount =
    (s1.post?1:0) + (s1.shop?1:0) + (s1.sight?1:0) +
    (s2.shopA?1:0) + (s2.shopB?1:0) + (s2.alt?1:0) +
    (s3.shopA?1:0) + (s3.shopB?1:0) + (s3.shopC?1:0);

  let stage=1; if(s1ok) stage=2; if(s2ok) stage=3; if(s3ok) stage=3;

  // Tier suggestion: S1=Common/Uncommon, S2=Rare/Ultra Rare, S3=Legendary
  const tier = s3ok ? 'Legendary'
              : s2ok ? 'Rare â†’ Ultra Rare'
              : s1ok ? 'Common â†’ Uncommon'
              : 'â€”';

  return {done, s1, s2, s3, s1ok, s2ok, s3ok, stage, overallCount, tier};
}

/* ================== render UI ================== */
const st1El=document.getElementById('stStep1'), st2El=document.getElementById('stStep2'), st3El=document.getElementById('stStep3');
const barFill=document.getElementById('barFill'), stageNum=document.getElementById('stageNum'), stageHint=document.getElementById('stageHint');
const pills=document.getElementById('progressPills'), tierLine=document.getElementById('tierLine');
const overallFill=document.getElementById('overallFill'), overallPct=document.getElementById('overallPct');

function pill(text){ const el=document.createElement('span'); el.className='pill ok'; el.textContent=text; return el; }

function render(){
  const st=getState();
  const lang = langSel.value;

  // Stage tracker
  st1El.classList.toggle('done', st.s1ok);
  st2El.classList.toggle('done', st.s2ok);
  st3El.classList.toggle('done', st.s3ok);
  const trackerSteps = (st.s1ok?1:0)+(st.s2ok?1:0)+(st.s3ok?1:0);
  barFill.style.width = (trackerSteps/3*100)+'%';
  stageNum.textContent = st.stage;
  stageHint.textContent =
    st.stage===1 ? t(lang,'stage.hint1') :
    st.stage===2 ? t(lang,'stage.hint2') : t(lang,'stage.hint3');

  // Show/hide stage cards gating
  document.getElementById('s2Card').style.display = st.s1ok ? '' : 'none';
  document.getElementById('s3Card').style.display = st.s2ok ? '' : 'none';

  // Progress pills
  pills.innerHTML='';
  st.done.forEach(k=>pills.appendChild(pill(k)));

  // Overall progress (out of 9)
  const pct = Math.round(st.overallCount/9*100);
  overallFill.style.width = pct+'%';
  overallPct.textContent = pct+'%';

  // Tier
  tierLine.textContent = 'Tier: ' + st.tier;
}

/* ================== interactions ================== */
// Stage 1: social
document.getElementById('s1PostBtn').onclick=()=>{
  const url=document.getElementById('s1PostUrl').value.trim();
  const stEl=document.getElementById('s1PostStatus');
  const lang=langSel.value;
  if(!/^https?:\/\//i.test(url)){ stEl.innerHTML='<span class="pill err">'+t(lang,'toast.validUrl')+'</span>'; return; }
  if(!/#?myhappybox/i.test(url)){ stEl.innerHTML='<span class="pill warn">'+t(lang,'toast.hashtag')+'</span>'; }
  addDone('s1:post'); stEl.innerHTML='<span class="pill ok">'+t(lang,'toast.okSubmitted')+'</span>'; render();
};
// Stage 1: shop (1)
document.getElementById('s1QrBtn').onclick=()=>{
  const code=(document.getElementById('s1Qr').value||'').trim().toUpperCase();
  const stEl=document.getElementById('s1QrStatus'); const lang=langSel.value;
  if(!code){ stEl.innerHTML='<span class="pill err">'+t(lang,'toast.enterCode')+'</span>'; return; }
  addDone('s1:shop'); stEl.innerHTML='<span class="pill ok">'+t(lang,'toast.okVerified')+'</span>'; render();
};
// Stage 1: sights (choose one)
document.getElementById('s1SightBtn').onclick=()=>{
  const A=document.getElementById('s1SightA').checked;
  const B=document.getElementById('s1SightB').checked;
  const stEl=document.getElementById('s1SightStatus'); const lang=langSel.value;
  if(!A && !B){ stEl.innerHTML='<span class="pill warn">'+t(lang,'toast.pickOne')+'</span>'; return; }
  if(A) addDone('s1:sightA'); if(B) addDone('s1:sightB');
  stEl.innerHTML='<span class="pill ok">'+t(lang,'toast.okSubmitted')+'</span>'; render();
};

// Stage 2: shops (2)
document.getElementById('s2QrBtn').onclick=()=>{
  const a=document.getElementById('s2QrA').value.trim().toUpperCase();
  const b=document.getElementById('s2QrB').value.trim().toUpperCase();
  const stEl=document.getElementById('s2QrStatus'); const lang=langSel.value;
  const G=getState();
  if(!G.s1ok){ stEl.innerHTML='<span class="pill warn">'+t(lang,'toast.stage1First')+'</span>'; return; }
  if(!a || !b){ stEl.innerHTML='<span class="pill err">'+t(lang,'toast.enterCode')+'</span>'; return; }
  addDone('s2:shopA'); addDone('s2:shopB');
  stEl.innerHTML='<span class="pill ok">'+t(lang,'toast.okBoth')+'</span>'; render();
};
// Stage 2: geo OR rack-railway url
document.getElementById('s2GeoBtn').onclick=()=>{
  const stEl=document.getElementById('s2GeoStatus'); const lang=langSel.value;
  const G=getState(); if(!G.s1ok){ stEl.innerHTML='<span class="pill warn">'+t(lang,'toast.stage1First')+'</span>'; return; }
  if(!navigator.geolocation){ stEl.innerHTML='<span class="pill err">'+t(lang,'toast.geoUnsupported')+'</span>'; return; }
  stEl.textContent='Checkingâ€¦';
  const HILL={lat:38.04952, lng:22.11163};
  navigator.geolocation.getCurrentPosition(pos=>{
    const d=haversine(pos.coords.latitude,pos.coords.longitude,HILL.lat,HILL.lng);
    if(d<=0.25){ addDone('s2:geo'); stEl.innerHTML='<span class="pill ok">'+t(lang,'toast.geoOk')+'</span>'; render(); }
    else{ stEl.innerHTML='<span class="pill warn">'+t(lang,'toast.geoFar').replace('{km}', d.toFixed(2))+'</span>'; }
  },err=>{ stEl.innerHTML='<span class="pill err">'+err.message+'</span>'; },{enableHighAccuracy:true,timeout:15000});
};
document.getElementById('s2RailBtn').onclick=()=>{
  const url=document.getElementById('s2RailUrl').value.trim();
  const stEl=document.getElementById('s2GeoStatus'); const lang=langSel.value;
  const G=getState(); if(!G.s1ok){ stEl.innerHTML='<span class="pill warn">'+t(lang,'toast.stage1First')+'</span>'; return; }
  if(!/^https?:\/\//i.test(url)){ stEl.innerHTML='<span class="pill err">'+t(lang,'toast.validUrl')+'</span>'; return; }
  addDone('s2:rail'); stEl.innerHTML='<span class="pill ok">'+t(lang,'toast.okSubmitted')+'</span>'; render();
};

// Stage 3: shops (3)
document.getElementById('s3QrBtn').onclick=()=>{
  const a=document.getElementById('s3QrA').value.trim().toUpperCase();
  const b=document.getElementById('s3QrB').value.trim().toUpperCase();
  const c=document.getElementById('s3QrC').value.trim().toUpperCase();
  const stEl=document.getElementById('s3QrStatus'); const lang=langSel.value;
  const G=getState(); if(!G.s2ok){ stEl.innerHTML='<span class="pill warn">'+t(lang,'toast.stage2First')+'</span>'; return; }
  if(!a||!b||!c){ stEl.innerHTML='<span class="pill err">'+t(lang,'toast.enterCode')+'</span>'; return; }
  addDone('s3:shopA'); addDone('s3:shopB'); addDone('s3:shopC');
  stEl.innerHTML='<span class="pill ok">'+t(lang,'toast.okVerified')+'</span>'; render();
};

/* ================== claim flow ================== */
const modal=document.getElementById('modal');
document.getElementById('mintInfoBtn').onclick=()=>openClaimInfo(false);
document.getElementById('claimBtn').onclick=()=>openClaimInfo(true);
document.getElementById('closeModal').onclick=()=>modal.classList.remove('show');
modal.onclick=(e)=>{ if(e.target===modal) modal.classList.remove('show'); };

function openClaimInfo(fromButton){
  const G=getState();
  const body=document.getElementById('modalBody');
  const lang=langSel.value;

  if(!G.s1ok){
    document.getElementById('modalTitle').textContent = t(lang,'modal.lockedTitle');
    body.innerHTML = t(lang,'modal.lockedBody');
  } else {
    document.getElementById('modalTitle').textContent = t(lang,'modal.unlockedTitle');
    body.innerHTML = t(lang,'modal.unlockedBody').replace('{tier}', G.tier==='â€”'?'Common â†’ Uncommon':G.tier);
  }
  modal.classList.add('show');
}

/* ================== reset ================== */
document.getElementById('resetBtn').onclick=()=>{ clearStore(); render(); };

/* ================== utils ================== */
function haversine(lat1,lon1,lat2,lon2){
  const R=6371, toRad=x=>x*Math.PI/180;
  const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
  const a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)); // km
}

/* ================== init ================== */
applyLang(langSel.value);
</script>
</body>
</html>
