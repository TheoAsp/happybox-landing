<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>my Happy Box ‚Äî Kalavryta Edition</title>

<style>
  :root{
    --brand:#ff7a00; --brand-soft:#ffb84d;
    --bg1:#fef9f5; --bg2:#fff6eb; --ink:#333; --muted:#555; --ink2:#222;
    --ok:#1f9d55; --warn:#e2a61f; --err:#d33c3c;
  }
  *{box-sizing:border-box}
  body{ margin:0; font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:var(--ink); overflow-x:hidden; }

  .confetti{ position:fixed; inset:0; pointer-events:none; opacity:.18;
    background:
      radial-gradient(circle at 10% 20%, #ff7a00 2px, transparent 3px) 0 0/120px 120px,
      radial-gradient(circle at 80% 30%, #ffb84d 2px, transparent 3px) 0 0/140px 140px,
      radial-gradient(circle at 30% 80%, #ffd699 2px, transparent 3px) 0 0/160px 160px;
    animation: floaty 14s linear infinite; }
  @keyframes floaty{from{transform:translateY(0)}to{transform:translateY(-120px)}}

  header{ text-align:center; padding:56px 20px 24px; animation:drop .8s ease forwards; }
  @keyframes drop{from{opacity:0; transform:translateY(-24px)}to{opacity:1; transform:translateY(0)}}

  .title{ margin:0; font-size:clamp(32px,6vw,56px); color:var(--brand);
    letter-spacing:.4px; display:flex; align-items:center; justify-content:center; gap:.35rem; }
  .title .my{ font-weight:700; font-size:.68em; color:#9a9a9a; margin-right:.15rem }
  .gift{ font-size:.9em; filter:drop-shadow(0 2px 2px rgba(0,0,0,.08)); }
  .edition{ margin:.25rem 0 0; font-size:clamp(14px,2.6vw,20px); color:var(--brand-soft);
    font-style:italic; display:inline-block; transform:rotate(-2deg);
    background:#fff; padding:6px 12px; border:1px dashed #ffd3a1; border-radius:999px; }
  .sub{ margin:14px auto 0; max-width:940px; font-size:clamp(14px,2.1vw,18px);
    color:var(--muted); line-height:1.55; text-align:center; padding:0 16px; }

  .controls{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px }
  .chip{ display:flex; align-items:center; gap:8px; background:#fff; border:1px solid #eee;
    padding:8px 12px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.06); font-size:14px; }
  .chip select{ border:1px solid #e6e6e6; border-radius:10px; padding:6px 10px }

  .hero-wrap{ display:flex; justify-content:center; padding:22px 16px 10px; }
  .hero-frame{ width:min(1020px,90vw); height:clamp(260px,48vw,560px);
    background:#fff; border:10px solid #fff; border-radius:18px; box-shadow:0 12px 36px rgba(0,0,0,.14);
    position:relative; overflow:hidden; }
  .hero-img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain;
    background:#fff; transition:opacity .5s ease; }
  .badge{ position:absolute; top:10px; left:10px; background:rgba(255,255,255,.9);
    color:#444; font-size:12px; padding:4px 8px; border-radius:999px; backdrop-filter:blur(6px); }
  .nav{ position:absolute; top:50%; transform:translateY(-50%); width:42px; height:42px; border-radius:50%;
    background:rgba(255,255,255,.9); display:grid; place-items:center; box-shadow:0 4px 16px rgba(0,0,0,.15);
    cursor:pointer; user-select:none; } .nav:hover{ filter:brightness(1.03) }
  .nav.prev{ left:10px } .nav.next{ right:10px }

  .example{ max-width:min(1020px,90vw); margin:26px auto 0; padding:18px 14px 8px;
    border-radius:18px; background:rgba(255,255,255,.65); box-shadow:0 8px 26px rgba(0,0,0,.08); }
  .example h4{ margin:0 0 10px 6px; font-size:13px; color:#666; font-weight:600; }
  .example-img{ display:block; width:100%; height:auto; border-radius:12px;
    background:#fff; border:10px solid #fff; box-shadow:0 8px 26px rgba(0,0,0,.08); }

  .quests{ max-width:min(1060px,92vw); margin:32px auto; padding:6px; }
  .card{ background:#fff; border-radius:14px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.08); margin-bottom:14px; }
  .card h3{ margin:4px 0 6px; font-size:20px } .card p{ margin:0 0 12px; color:#666 }
  .row{ display:flex; gap:8px; align-items:center; margin:8px 0; flex-wrap:wrap }
  .row input[type="text"], .row input[type="email"]{ flex:1; min-width:260px; padding:10px 12px; border:1px solid #e6e6e6; border-radius:10px; font-size:15px; }
  .btn{ appearance:none; border:none; cursor:pointer; color:#fff; background:var(--brand);
    padding:10px 14px; border-radius:10px; font-weight:700; box-shadow:0 8px 20px rgba(255,122,0,.3); }
  .btn.alt{ background:#444 } .btn.ghost{ background:#fff; color:#333; border:1px solid #ddd }
  .pill{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-size:13px; font-weight:600; margin:3px 6px 0 0 }
  .ok{ background:#eaf7f0; color:var(--ok) } .warn{ background:#fff6e0; color:var(--warn) } .err{ background:#fdecec; color:var(--err) }
  .status{ margin-top:6px; font-size:14px; color:#666 }

  .stage{ display:flex; align-items:center; gap:12px; margin:10px 0 6px }
  .step{ display:flex; align-items:center; gap:8px; color:#666; }
  .dot{ width:22px; height:22px; border-radius:50%; border:2px solid #ddd; display:grid; place-items:center; font-size:12px; background:#fff }
  .step.done .dot{ border-color:var(--ok); background:#eaf7f0; color:var(--ok) }
  .bar{ flex:1; height:4px; background:#eee; border-radius:999px; position:relative; overflow:hidden }
  .bar > span{ position:absolute; inset:0 0 0 auto; width:0%; background:linear-gradient(90deg,#27c498,#ffb84d); transition:width .4s ease }
  .sublabel{ font-size:12px; color:#888 }

  .overall{ display:flex; align-items:center; gap:12px; }
  .overall .meter{ flex:1; height:10px; background:#eee; border-radius:999px; overflow:hidden; }
  .overall .meter > span{ display:block; height:100%; width:0%; background:linear-gradient(90deg,#1f9d55,#ff7a00); transition:width .35s ease; }
  .overall .pct{ min-width:42px; font-weight:700; color:#444 }

  .cta{ text-align:center; padding:42px 20px 70px }
  .cta h2{ margin:0 0 10px; font-size:clamp(20px,4vw,28px); color:var(--ink2) }
  .cta p{ margin:0 0 16px; color:#muted }

  footer{ text-align:center; padding:18px; color:#999; font-size:13px }

  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:50; }
  .modal.show{ display:flex }
  .modal-card{ background:#fff; border-radius:16px; padding:26px 28px; box-shadow:0 20px 60px rgba(0,0,0,.25);
    text-align:center; min-width:min(90vw,520px); }
  .modal-card h3{ margin:0 0 10px }
  .modal-card p{ margin:0 0 10px; color:#555 }
  .modal-card .mini{ font-size:12px; color:#777; margin-top:4px }
  .close{ border:none; background:#eee; border-radius:10px; padding:10px 16px; cursor:pointer; }
  .disabled{ opacity:.55; cursor:not-allowed }

  #victory{ position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,.55); z-index:9999; }
  #victory.show{ display:flex; animation:fadeIn .25s ease }
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  .victory-card{ position:relative; text-align:center; background:#fff; border-radius:20px;
    padding:28px 28px 22px; box-shadow:0 24px 80px rgba(0,0,0,.35); overflow:hidden; }
  .victory-card h2{ margin:0 0 6px; font-size:clamp(22px,4vw,32px); color:#222 }
  .victory-card p{ margin:0 0 14px; color:#666 }
  .trophy{ font-size:64px; margin-bottom:8px; animation:pop .5s ease both }
  .confetti-fx{ position:absolute; inset:-20px; pointer-events:none }
  .piece{ position:absolute; width:10px; height:14px; border-radius:2px; opacity:.9;
    animation:fall 1.2s linear forwards, spin 1.2s linear forwards; }
  @keyframes fall{ from{ transform:translateY(-40vh) } to{ transform:translateY(60vh) } }
  @keyframes spin{ from{ transform:rotate(0) } to{ transform:rotate(720deg) } }
</style>
</head>
<body>
  <div class="confetti" aria-hidden="true"></div>

  <header>
    <h1 class="title"><span class="my">my</span> Happy Box <span class="gift">üéÅ</span></h1>
    <div class="edition" data-i18n="edition">Kalavryta Edition</div>
    <p class="sub" data-i18n="intro">
      A joyful mini-game for travelers! Complete quests around Kalavryta to level-up your reward.  
      Unlock one of <strong>1,000 limited-edition NFT photos</strong> ‚Äî the rarer your tier, the rarer your art.
      Have fun, explore, win surprises!
    </p>

    <div class="controls">
<!-- ADD: Email chip (Œ≤Œ¨ŒªŒµ œÑŒø ŒºŒ≠œÉŒ± œÉœÑŒø .controls) -->
<div class="chip">
  <label for="userEmail" style="font-size:14px;margin-right:6px">Email:</label>
  <input type="email" id="userEmail" placeholder="you@example.com" style="border:1px solid #e6e6e6;border-radius:10px;padding:6px 10px;min-width:220px">
</div>
      <div class="chip">
        <span data-i18n="lang.label">Language:</span>
        <select id="langSelect" aria-label="Language">
          <option value="en">English</option>
          <option value="el">ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</option>
        </select>
      </div>
      <div class="chip">
        <span data-i18n="season.label">Season in Kalavryta:</span>
        <select id="seasonSelect">
          <option value="auto" data-i18n="season.auto">Auto (recommended)</option>
          <option value="winter" data-i18n="season.winter">Winter (Dec‚ÄìMar)</option>
          <option value="spring" data-i18n="season.spring">Spring (Apr‚ÄìMay)</option>
          <option value="summer" data-i18n="season.summer">Summer (Jun‚ÄìSep)</option>
          <option value="autumn" data-i18n="season.autumn">Autumn (Oct‚ÄìNov)</option>
        </select>
        <span id="seasonNote" class="sublabel">We‚Äôll adapt attractions to access & weather.</span>
      </div>
    </div>
  </header>

  <section class="hero-wrap">
    <div class="hero-frame" id="heroFrame">
      <div class="badge" data-i18n="slider.badge">Kalavryta preview</div>
      <img id="heroImg" class="hero-img" src="public/photos/2.png" alt="Kalavryta preview" />
      <div class="nav prev" id="prevBtn" aria-label="Previous">‚Äπ</div>
      <div class="nav next" id="nextBtn" aria-label="Next">‚Ä∫</div>
    </div>
  </section>

  <section class="example">
    <h4 data-i18n="bundle.title">Bundle example</h4>
    <img class="example-img" src="public/photos/1.png" alt="Bundle Minted example" />
  </section>

  <section class="quests">

    <div class="card" id="stageCard">
      <h3><span data-i18n="stage.title">Stage</span> <span id="stageNum">1</span> ‚Äî <span data-i18n="stage.subtitle">Play to unlock the next!</span></h3>
      <div class="stage">
        <div class="step" id="stStep1"><div class="dot">1</div><div data-i18n="stage.s1">Stage 1</div></div>
        <div class="bar"><span id="barFill"></span></div>
        <div class="step" id="stStep2"><div class="dot">2</div><div data-i18n="stage.s2">Stage 2</div></div>
        <div class="bar" style="max-width:120px"><span></span></div>
        <div class="step" id="stStep3"><div class="dot">3</div><div data-i18n="stage.s3">Stage 3</div></div>
      </div>
      <div class="sublabel" id="stageHint">Finish Stage 1 to unlock Stage 2 ‚Äî and aim for rarer tiers.</div>
    </div>

    <div class="card" id="s1Card">
      <h3 data-i18n="s1.title">Stage 1 ‚Äî Warm-up (üéØ complete 3/3)</h3>
      <p data-i18n="s1.desc">You need: 1 social + 1 shop + <strong>1 of the attractions</strong> (extra attractions = bonus).</p>

      <div class="row"><span data-i18n="social.label">üì∏ Post with hashtag #myhappybox</span></div>
      <div class="row">
        <input type="text" id="s1PostUrl" placeholder="Public post URL (e.g. Instagram)">
        <button class="btn" id="s1PostBtn" data-i18n="btn.submit">Submit link</button>
      </div>
      <div class="status" id="s1PostStatus"></div>

      <div class="row" style="margin-top:10px"><span data-i18n="shops.s1">üè™ Partner Shop (Stage 1)</span></div>
      <div class="row">
        <input type="text" id="s1Qr" placeholder="Enter QR code (placeholder)">
        <button class="btn" id="s1QrBtn" data-i18n="btn.verify">Verify QR</button>
      </div>
      <div class="status" id="s1QrStatus"></div>

      <div class="row" style="margin-top:10px"><span data-i18n="attr.pick">üó∫Ô∏è Attractions ‚Äî pick at least one:</span></div>
      <div class="row" id="s1AttrList"></div>
      <div class="row"><button class="btn ghost" id="s1AttrBtn" data-i18n="btn.markVisited">Mark visited</button></div>
      <div class="status" id="s1AttrStatus"></div>
    </div>

    <div class="card" id="s2Card">
      <h3 data-i18n="s2.title">Stage 2 ‚Äî Explore more (üéØ complete 3/3)</h3>
      <p data-i18n="s2.desc">Requires Stage 1 complete. You need: 2 shops + <strong>1 of the attractions</strong> (extras = bonus).</p>

      <div class="row"><span data-i18n="shops.s2">üè™ Partner Shops (Stage 2)</span></div>
      <div class="row">
        <input type="text" id="s2QrA" placeholder="Enter QR code for Shop 2A">
        <input type="text" id="s2QrB" placeholder="Enter QR code for Shop 2B">
        <button class="btn" id="s2QrBtn" data-i18n="btn.verifyBoth">Verify both</button>
      </div>
      <div class="status" id="s2QrStatus"></div>

      <div class="row" style="margin-top:10px"><span data-i18n="attr.pick">üó∫Ô∏è Attractions ‚Äî pick at least one:</span></div>
      <div class="row" id="s2AttrList" style="gap:14px; align-items:flex-start"></div>
      <div class="row"><button class="btn ghost" id="s2AttrBtn" data-i18n="btn.markVisited">Mark visited</button></div>
      <div class="status" id="s2AttrStatus"></div>
    </div>

    <div class="card" id="s3Card">
      <h3 data-i18n="s3.title">Stage 3 ‚Äî The finale (üéØ complete 4/4)</h3>
      <p data-i18n="s3.desc">Requires Stage 2 complete. You need: 3 shops + <strong>1 of the attractions</strong> (extras = bonus).</p>

      <div class="row"><span data-i18n="shops.s3">üè™ Partner Shops (Stage 3)</span></div>
      <div class="row">
        <input type="text" id="s3QrA" placeholder="QR for Shop 3A">
        <input type="text" id="s3QrB" placeholder="QR for Shop 3B">
        <input type="text" id="s3QrC" placeholder="QR for Shop 3C">
        <button class="btn" id="s3QrBtn" data-i18n="btn.verifyAll">Verify all</button>
      </div>
      <div class="status" id="s3QrStatus"></div>

      <div class="row" style="margin-top:10px"><span data-i18n="attr.pick">üó∫Ô∏è Attractions ‚Äî pick at least one:</span></div>
      <div class="row" id="s3AttrList" style="flex-direction:column; align-items:flex-start"></div>
      <div class="row"><button class="btn ghost" id="s3AttrBtn" data-i18n="btn.markVisited" style="margin-top:6px">Mark visited</button></div>
      <div class="status" id="s3AttrStatus"></div>
    </div>

    <div class="card" id="progressCard">
      <h3 data-i18n="progress.title">Your Progress</h3>

      <div class="overall" style="margin:8px 0 10px">
        <div class="meter"><span id="overallFill"></span></div>
        <div class="pct" id="overallPct">0%</div>
      </div>

      <div id="progressPills" class="row" style="flex-wrap:wrap"></div>
      <p class="status" id="tierLine">Tier: ‚Äî</p>
      <div class="row">
        <button class="btn alt" id="resetBtn" data-i18n="btn.reset">Reset demo</button>
        <button class="btn" id="claimBtn">üéÅ <span data-i18n="btn.claim">Claim your Happy Box</span></button>
      </div>
      <p class="status" data-i18n="claim.note">Claim becomes available once you complete <strong>Stage 1</strong>. You can keep playing for rarer tiers!</p>
    </div>
  </section>

  <section class="cta">
    <h2 data-i18n="cta.title">Explore ‚Ä¢ Play ‚Ä¢ Win</h2>
    <p data-i18n="cta.desc">It‚Äôs a friendly treasure-hunt across Kalavryta. Finish Stage 1 to unlock Stage 2 and go for rarer rewards!</p>
    <button id="mintInfoBtn" class="btn" data-i18n="btn.howClaim">How claiming works</button>
  </section>

  <footer>¬© 2025 Happy Box. All rights reserved.</footer>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-card">
      <h3 id="modalTitle">Claiming</h3>
      <div id="modalBody"></div>
      <p class="mini" data-i18n="claim.mini">Your tier is calculated automatically from your completed quests.</p>
      <button class="close" id="closeModal" data-i18n="btn.close">Close</button>
    </div>
  </div>

  <!-- Victory overlay -->
  <div id="victory" aria-hidden="true">
    <div class="victory-card">
      <div class="confetti-fx" id="confettiFx"></div>
      <div class="trophy">üèÜ</div>
      <h2 data-i18n="victory.title">All quests complete!</h2>
      <p data-i18n="victory.desc">You‚Äôve reached 100% progress. Time to claim your top reward! üéâ</p>
      <button class="btn" id="victoryClose" data-i18n="btn.awesome">Awesome!</button>
    </div>
  </div>

<script>
/* ========= constants ========= */

const LS_KEY='hb_demo_progress_v5';
const LS_VICTORY='hb_demo_victory_once';
const LS_SEASON='hb_demo_season';
const LS_LANG='hb_demo_lang';

/* i18n strings */
const T = {
  en:{
    edition:"Kalavryta Edition",
    intro:"A joyful mini-game for travelers! Complete quests around Kalavryta to level-up your reward. Unlock one of <strong>1,000 limited-edition NFT photos</strong> ‚Äî the rarer your tier, the rarer your art. Have fun, explore, win surprises!",
    "lang.label":"Language:",
    "season.label":"Season in Kalavryta:",
    "season.auto":"Auto (recommended)",
    "season.winter":"Winter (Dec‚ÄìMar)",
    "season.spring":"Spring (Apr‚ÄìMay)",
    "season.summer":"Summer (Jun‚ÄìSep)",
    "season.autumn":"Autumn (Oct‚ÄìNov)",
    "slider.badge":"Kalavryta preview",
    "bundle.title":"Bundle example",
    "stage.title":"Stage",
    "stage.subtitle":"Play to unlock the next!",
    "stage.s1":"Stage 1",
    "stage.s2":"Stage 2",
    "stage.s3":"Stage 3",
    "s1.title":"Stage 1 ‚Äî Warm-up (üéØ complete 3/3)",
    "s1.desc":"You need: 1 social + 1 shop + <strong>1 of the attractions</strong> (extra attractions = bonus).",
    "s2.title":"Stage 2 ‚Äî Explore more (üéØ complete 3/3)",
    "s2.desc":"Requires Stage 1 complete. You need: 2 shops + <strong>1 of the attractions</strong> (extras = bonus).",
    "s3.title":"Stage 3 ‚Äî The finale (üéØ complete 4/4)",
    "s3.desc":"Requires Stage 2 complete. You need: 3 shops + <strong>1 of the attractions</strong> (extras = bonus).",
    "social.label":"üì∏ Post with hashtag #myhappybox",
    "shops.s1":"üè™ Partner Shop (Stage 1)",
    "shops.s2":"üè™ Partner Shops (Stage 2)",
    "shops.s3":"üè™ Partner Shops (Stage 3)",
    "attr.pick":"üó∫Ô∏è Attractions ‚Äî pick at least one:",
    "btn.submit":"Submit link",
    "btn.verify":"Verify QR",
    "btn.verifyBoth":"Verify both",
    "btn.verifyAll":"Verify all",
    "btn.markVisited":"Mark visited",
    "btn.reset":"Reset demo",
    "btn.claim":"Claim your Happy Box",
    "btn.howClaim":"How claiming works",
    "btn.close":"Close",
    "btn.awesome":"Awesome!",
    "claim.note":"Claim becomes available once you complete <strong>Stage 1</strong>. You can keep playing for rarer tiers!",
    "claim.needS1":"To claim your gift, please complete <strong>Stage 1</strong> first:",
    "claim.points":"Then you can claim a <strong>Common / Uncommon</strong> NFT ‚Äî or keep playing for rarer tiers.",
    "claim.unlocked1":"Nice! You‚Äôve unlocked claiming.",
    "claim.unlocked2":"You can mint a <strong>{tier}</strong> NFT based on your progress.",
    "claim.unlocked3":"Extra attractions and higher stages increase your rarity odds (up to Legendary).",
    "claim.mini":"Your tier is calculated automatically from your completed quests.",
    "victory.title":"All quests complete!",
    "victory.desc":"You‚Äôve reached 100% progress. Time to claim your top reward! üéâ",
    "note.winter":"Winter mode: Ski Center appears in Stage 2.",
    "note.summer":"Summer mode: Ski Center appears in Stage 3.",
    "note.spring":"Spring mode: Ski Center appears in Stage 3.",
    "note.autumn":"Autumn mode: Ski Center appears in Stage 3.",
    "bullet.post":"üì∏ Public post (#myhappybox)",
    "bullet.shop1":"üè™ Scan one partner shop QR",
    "bullet.s1attr":"üó∫Ô∏è Visit at least one attraction from Stage 1",
    /* Mint modal (new) */
    "mint.title":"Claim your NFT",
    "mint.emailLabel":"Your email (to receive the NFT link)",
    "mint.emailPlaceholder":"you@example.com",
    "mint.cta":"Your tier: <strong>{tier}</strong>. Enter your email and mint now:",
    "mint.sending":"Minting‚Ä¶ please wait",
    "mint.success":"Success! Check your inbox for your NFT.",
    "mint.error":"Something went wrong. Please try again in a moment.",
    "btn.mintNow":"Mint now"
  },
  el:{
    edition:"Kalavryta Edition",
    intro:"ŒàŒΩŒ± œáŒ±œÅŒøœçŒºŒµŒΩŒø mini-game Œ≥ŒπŒ± œÑŒ±ŒæŒπŒ¥ŒπœéœÑŒµœÇ! ŒöŒ¨ŒΩŒµ quests œÉœÑŒ± ŒöŒ±ŒªŒ¨Œ≤œÅœÖœÑŒ± Œ∫Œ±Œπ Œ±ŒΩŒ≠Œ≤Œ±œÉŒµ œÑŒø reward œÉŒøœÖ. ŒöŒªŒµŒØŒ¥œâœÉŒµ Œ≠ŒΩŒ± Œ±œÄœå œÑŒ± <strong>1.000 œÉœÖŒªŒªŒµŒ∫œÑŒπŒ∫Œ¨ NFT</strong> ‚Äî œåœÉŒø œÄŒπŒø œÖœàŒ∑Œªœå tier, œÑœåœÉŒø œÄŒπŒø œÉœÄŒ¨ŒΩŒπŒø œÑŒø Œ≠œÅŒ≥Œø. ŒîŒπŒ±œÉŒ∫Œ≠Œ¥Œ±œÉŒµ, ŒµŒæŒµœÅŒµœçŒΩŒ∑œÉŒµ, Œ∫Œ≠œÅŒ¥ŒπœÉŒµ!",
    "lang.label":"ŒìŒªœéœÉœÉŒ±:",
    "season.label":"ŒïœÄŒøœáŒÆ œÉœÑŒ± ŒöŒ±ŒªŒ¨Œ≤œÅœÖœÑŒ±:",
    "season.auto":"ŒëœÖœÑœåŒºŒ±œÑŒø (œÄœÅŒøœÑŒµŒØŒΩŒµœÑŒ±Œπ)",
    "season.winter":"ŒßŒµŒπŒºœéŒΩŒ±œÇ (ŒîŒµŒ∫‚ÄìŒúŒ±œÅ)",
    "season.spring":"ŒÜŒΩŒøŒπŒæŒ∑ (ŒëœÄœÅ‚ÄìŒúŒ±Œπ)",
    "season.summer":"ŒöŒ±ŒªŒøŒ∫Œ±ŒØœÅŒπ (ŒôŒøœÖŒΩ‚ÄìŒ£ŒµœÄ)",
    "season.autumn":"Œ¶Œ∏ŒπŒΩœåœÄœâœÅŒø (ŒüŒ∫œÑ‚ÄìŒùŒøŒµ)",
    "slider.badge":"Œ†œÅŒøŒµœÄŒπœÉŒ∫œåœÄŒ∑œÉŒ∑ ŒöŒ±ŒªŒ±Œ≤œÅœçœÑœâŒΩ",
    "bundle.title":"Œ†Œ±œÅŒ¨Œ¥ŒµŒπŒ≥ŒºŒ± bundle",
    "stage.title":"Œ£œÑŒ¨Œ¥ŒπŒø",
    "stage.subtitle":"Œ†Œ±ŒØŒæŒµ Œ≥ŒπŒ± ŒΩŒ± ŒæŒµŒ∫ŒªŒµŒπŒ¥œéœÉŒµŒπœÇ œÑŒø ŒµœÄœåŒºŒµŒΩŒø!",
    "stage.s1":"Œ£œÑŒ¨Œ¥ŒπŒø 1",
    "stage.s2":"Œ£œÑŒ¨Œ¥ŒπŒø 2",
    "stage.s3":"Œ£œÑŒ¨Œ¥ŒπŒø 3",
    "s1.title":"Œ£œÑŒ¨Œ¥ŒπŒø 1 ‚Äî ŒñŒ≠œÉœÑŒ±ŒºŒ± (üéØ ŒøŒªŒøŒ∫ŒªŒÆœÅœâœÉŒµ 3/3)",
    "s1.desc":"ŒßœÅŒµŒπŒ¨Œ∂ŒµœÉŒ±Œπ: 1 social + 1 Œ∫Œ±œÑŒ¨œÉœÑŒ∑ŒºŒ± + <strong>1 Œ±œÄœå œÑŒ± Œ±ŒæŒπŒøŒ∏Œ≠Œ±œÑŒ±</strong> (Œ≠ŒæœÑœÅŒ± Œ±ŒæŒπŒøŒ∏Œ≠Œ±œÑŒ± = bonus).",
    "s2.title":"Œ£œÑŒ¨Œ¥ŒπŒø 2 ‚Äî Œ†ŒµœÅŒπœÉœÉœåœÑŒµœÅŒ∑ ŒµŒæŒµœÅŒµœçŒΩŒ∑œÉŒ∑ (üéØ 3/3)",
    "s2.desc":"ŒëœÄŒ±ŒπœÑŒµŒØœÑŒ±Œπ ŒøŒªŒøŒ∫ŒªŒÆœÅœâœÉŒ∑ Œ£œÑŒ±Œ¥ŒØŒøœÖ 1. ŒòŒ≠ŒªŒµŒπœÇ: 2 Œ∫Œ±œÑŒ±œÉœÑŒÆŒºŒ±œÑŒ± + <strong>1 Œ±œÄœå œÑŒ± Œ±ŒæŒπŒøŒ∏Œ≠Œ±œÑŒ±</strong> (Œ≠ŒæœÑœÅŒ± = bonus).",
    "s3.title":"Œ£œÑŒ¨Œ¥ŒπŒø 3 ‚Äî Œ§ŒµŒªŒπŒ∫œåœÇ (üéØ 4/4)",
    "s3.desc":"ŒëœÄŒ±ŒπœÑŒµŒØœÑŒ±Œπ ŒøŒªŒøŒ∫ŒªŒÆœÅœâœÉŒ∑ Œ£œÑŒ±Œ¥ŒØŒøœÖ 2. ŒòŒ≠ŒªŒµŒπœÇ: 3 Œ∫Œ±œÑŒ±œÉœÑŒÆŒºŒ±œÑŒ± + <strong>1 Œ±œÄœå œÑŒ± Œ±ŒæŒπŒøŒ∏Œ≠Œ±œÑŒ±</strong> (Œ≠ŒæœÑœÅŒ± = bonus).",
    "social.label":"üì∏ ŒëŒΩŒ≠Œ≤Œ±œÉŒµ post ŒºŒµ #myhappybox",
    "shops.s1":"üè™ Œ£œÖŒΩŒµœÅŒ≥Œ±Œ∂œåŒºŒµŒΩŒø Œ∫Œ±œÑŒ¨œÉœÑŒ∑ŒºŒ± (Œ£œÑŒ¨Œ¥ŒπŒø 1)",
    "shops.s2":"üè™ Œ£œÖŒΩŒµœÅŒ≥Œ±Œ∂œåŒºŒµŒΩŒ± Œ∫Œ±œÑŒ±œÉœÑŒÆŒºŒ±œÑŒ± (Œ£œÑŒ¨Œ¥ŒπŒø 2)",
    "shops.s3":"üè™ Œ£œÖŒΩŒµœÅŒ≥Œ±Œ∂œåŒºŒµŒΩŒ± Œ∫Œ±œÑŒ±œÉœÑŒÆŒºŒ±œÑŒ± (Œ£œÑŒ¨Œ¥ŒπŒø 3)",
    "attr.pick":"üó∫Ô∏è ŒëŒæŒπŒøŒ∏Œ≠Œ±œÑŒ± ‚Äî Œ¥ŒπŒ¨ŒªŒµŒæŒµ œÑŒøœÖŒªŒ¨œáŒπœÉœÑŒøŒΩ Œ≠ŒΩŒ±:",
    "btn.submit":"Œ•œÄŒøŒ≤ŒøŒªŒÆ link",
    "btn.verify":"ŒàŒªŒµŒ≥œáŒøœÇ QR",
    "btn.verifyBoth":"ŒàŒªŒµŒ≥œáŒøœÇ Œ∫Œ±Œπ œÑœâŒΩ Œ¥œçŒø",
    "btn.verifyAll":"ŒàŒªŒµŒ≥œáŒøœÇ œåŒªœâŒΩ",
    "btn.markVisited":"Œ£ŒÆŒºŒ±ŒΩœÉŒ∑ ŒµœÄŒØœÉŒ∫ŒµœàŒ∑œÇ",
    "btn.reset":"Reset demo",
    "btn.claim":"Œ†Œ¨œÅŒµ œÑŒø Happy Box œÉŒøœÖ",
    "btn.howClaim":"Œ†œéœÇ ŒªŒµŒπœÑŒøœÖœÅŒ≥ŒµŒØ œÑŒø claim",
    "btn.close":"ŒöŒªŒµŒØœÉŒπŒºŒø",
    "btn.awesome":"Œ§Œ≠ŒªŒµŒπŒø!",
    "claim.note":"Œ§Œø claim ŒµŒΩŒµœÅŒ≥ŒøœÄŒøŒπŒµŒØœÑŒ±Œπ ŒºœåŒªŒπœÇ ŒøŒªŒøŒ∫ŒªŒ∑œÅœéœÉŒµŒπœÇ œÑŒø <strong>Œ£œÑŒ¨Œ¥ŒπŒø 1</strong>. ŒúœÄŒøœÅŒµŒØœÇ ŒΩŒ± œÉœÖŒΩŒµœáŒØœÉŒµŒπœÇ Œ≥ŒπŒ± œÉœÄŒ±ŒΩŒπœåœÑŒµœÅŒ± tiers!",
    "claim.needS1":"ŒìŒπŒ± ŒΩŒ± œÄŒ±œÅŒ±ŒªŒ¨Œ≤ŒµŒπœÇ œÑŒø Œ¥œéœÅŒø œÉŒøœÖ, ŒøŒªŒøŒ∫ŒªŒÆœÅœâœÉŒµ œÄœÅœéœÑŒ± œÑŒø <strong>Œ£œÑŒ¨Œ¥ŒπŒø 1</strong>:",
    "claim.points":"ŒàœÄŒµŒπœÑŒ± ŒºœÄŒøœÅŒµŒØœÇ ŒΩŒ± Œ∫Œ¨ŒΩŒµŒπœÇ claim Œ≠ŒΩŒ± <strong>Common / Uncommon</strong> NFT ‚Äî ŒÆ ŒΩŒ± œÉœÖŒΩŒµœáŒØœÉŒµŒπœÇ Œ≥ŒπŒ± œÉœÄŒ±ŒΩŒπœåœÑŒµœÅŒ±.",
    "claim.unlocked1":"ŒúœÄœÅŒ¨Œ≤Œø! ŒûŒµŒ∫ŒªŒµŒØŒ¥œâœÉŒµœÇ œÑŒø claim.",
    "claim.unlocked2":"ŒúœÄŒøœÅŒµŒØœÇ ŒΩŒ± Œ∫Œ¨ŒΩŒµŒπœÇ mint Œ≠ŒΩŒ± <strong>{tier}</strong> NFT Œ≤Œ¨œÉŒµŒπ œÑŒ∑œÇ œÄœÅŒøœåŒ¥ŒøœÖ œÉŒøœÖ.",
    "claim.unlocked3":"Œ†ŒµœÅŒπœÉœÉœåœÑŒµœÅŒ± Œ±ŒæŒπŒøŒ∏Œ≠Œ±œÑŒ± Œ∫Œ±Œπ œÉœÑŒ¨Œ¥ŒπŒ± Œ±œÖŒæŒ¨ŒΩŒøœÖŒΩ œÑŒ∑ŒΩ œÄŒπŒ∏Œ±ŒΩœåœÑŒ∑œÑŒ± Œ≥ŒπŒ± Legendary.",
    "claim.mini":"Œ§Œø tier œÖœÄŒøŒªŒøŒ≥ŒØŒ∂ŒµœÑŒ±Œπ Œ±œÖœÑœåŒºŒ±œÑŒ± Œ±œÄœå œÑŒ± quests œÄŒøœÖ ŒøŒªŒøŒ∫ŒªŒÆœÅœâœÉŒµœÇ.",
    "victory.title":"ŒüŒªŒøŒ∫ŒªŒÆœÅœâœÉŒµœÇ œåŒªŒµœÇ œÑŒπœÇ Œ±œÄŒøœÉœÑŒøŒªŒ≠œÇ!",
    "victory.desc":"ŒàœÜœÑŒ±œÉŒµœÇ 100% œÄœÅœåŒøŒ¥Œø. ŒèœÅŒ± Œ≥ŒπŒ± œÑŒø Œ∫ŒøœÅœÖœÜŒ±ŒØŒø reward! üéâ",
    "note.winter":"ŒßŒµŒπŒºœéŒΩŒ±œÇ: Œ§Œø ŒßŒπŒøŒΩŒøŒ¥œÅŒøŒºŒπŒ∫œå ŒµŒºœÜŒ±ŒΩŒØŒ∂ŒµœÑŒ±Œπ œÉœÑŒø Œ£œÑŒ¨Œ¥ŒπŒø 2.",
    "note.summer":"ŒöŒ±ŒªŒøŒ∫Œ±ŒØœÅŒπ: Œ§Œø ŒßŒπŒøŒΩŒøŒ¥œÅŒøŒºŒπŒ∫œå ŒµŒºœÜŒ±ŒΩŒØŒ∂ŒµœÑŒ±Œπ œÉœÑŒø Œ£œÑŒ¨Œ¥ŒπŒø 3.",
    "note.spring":"ŒÜŒΩŒøŒπŒæŒ∑: Œ§Œø ŒßŒπŒøŒΩŒøŒ¥œÅŒøŒºŒπŒ∫œå ŒµŒºœÜŒ±ŒΩŒØŒ∂ŒµœÑŒ±Œπ œÉœÑŒø Œ£œÑŒ¨Œ¥ŒπŒø 3.",
    "note.autumn":"Œ¶Œ∏ŒπŒΩœåœÄœâœÅŒø: Œ§Œø ŒßŒπŒøŒΩŒøŒ¥œÅŒøŒºŒπŒ∫œå ŒµŒºœÜŒ±ŒΩŒØŒ∂ŒµœÑŒ±Œπ œÉœÑŒø Œ£œÑŒ¨Œ¥ŒπŒø 3.",
    "bullet.post":"üì∏ ŒîŒ∑ŒºœåœÉŒπŒø post (#myhappybox)",
    "bullet.shop1":"üè™ Œ£Œ∫Œ¨ŒΩŒ±œÅŒµ Œ≠ŒΩŒ± QR œÉœÖŒΩŒµœÅŒ≥Œ±Œ∂œåŒºŒµŒΩŒøœÖ",
    "bullet.s1attr":"üó∫Ô∏è ŒïœÄŒØœÉŒ∫ŒµœàŒ∑ œÉŒµ œÑŒøœÖŒª. 1 Œ±ŒæŒπŒøŒ∏Œ≠Œ±œÑŒø Œ±œÄœå œÑŒø Œ£œÑŒ¨Œ¥ŒπŒø 1",
    /* Mint modal (new) */
    "mint.title":"ŒöŒ¨ŒΩŒµ claim œÑŒø NFT œÉŒøœÖ",
    "mint.emailLabel":"Œ§Œø email œÉŒøœÖ (Œ≥ŒπŒ± ŒΩŒ± ŒªŒ¨Œ≤ŒµŒπœÇ œÑŒø link)",
    "mint.emailPlaceholder":"you@example.com",
    "mint.cta":"Œ§Œø tier œÉŒøœÖ: <strong>{tier}</strong>. ŒíŒ¨ŒªŒµ email Œ∫Œ±Œπ Œ∫Œ¨ŒΩŒµ mint:",
    "mint.sending":"ŒìŒØŒΩŒµœÑŒ±Œπ mint‚Ä¶ ŒªŒØŒ≥Œø œÖœÄŒøŒºŒøŒΩŒÆ",
    "mint.success":"ŒïœÄŒπœÑœÖœáŒØŒ±! ŒàŒªŒµŒ≥ŒæŒµ œÑŒø inbox œÉŒøœÖ Œ≥ŒπŒ± œÑŒø NFT.",
    "mint.error":"ŒöŒ¨œÑŒπ œÄŒÆŒ≥Œµ œÉœÑœÅŒ±Œ≤Œ¨. ŒîŒøŒ∫ŒØŒºŒ±œÉŒµ ŒæŒ±ŒΩŒ¨ œÉŒµ ŒªŒØŒ≥Œø.",
    "btn.mintNow":"Mint œÑœéœÅŒ±"
  }
};

/* attractions dictionary */
const ATTR = {
  museum:{en:"Municipal Museum of the Kalavryta Holocaust üèõÔ∏è", el:"ŒîŒ∑ŒºŒøœÑŒπŒ∫œå ŒúŒøœÖœÉŒµŒØŒø ŒöŒ±ŒªŒ±Œ≤œÅœÖœÑŒπŒΩŒøœç ŒüŒªŒøŒ∫Œ±œÖœÑœéŒºŒ±œÑŒøœÇ üèõÔ∏è"},
  agialavra:{en:"Monastery of Agia Lavra ‚õ™", el:"ŒúŒøŒΩŒÆ ŒëŒ≥ŒØŒ±œÇ ŒõŒ±œçœÅŒ±œÇ ‚õ™"},
  odontotos:{en:"Odontotos Rack Railway üöÜ", el:"Odontotos Rack Railway üöÜ"},
  cave:{en:"Cave of Lakes üï≥Ô∏è", el:"Œ£œÄŒÆŒªŒ±ŒπŒø œÑœâŒΩ ŒõŒπŒºŒΩœéŒΩ üï≥Ô∏è"},
  hill:{en:"Place of Sacrifice / Hill of Kapi ‚õ∞Ô∏è", el:"Œ§œåœÄŒøœÇ ŒòœÖœÉŒØŒ±œÇ / ŒõœåœÜŒøœÇ œÑŒøœÖ ŒöŒ±œÄŒπ ‚õ∞Ô∏è"},
  heroes:{en:"Heroes of 1821 Monument üóø", el:"ŒúŒΩŒ∑ŒºŒµŒØŒø ŒóœÅœéœâŒΩ ŒëŒ≥œâŒΩŒπœÉœÑœéŒΩ œÑŒøœÖ 1821 üóø"},
  ski:{en:"Kalavryta Ski Center üéø", el:"ŒßŒπŒøŒΩŒøŒ¥œÅŒøŒºŒπŒ∫œå Œ∫Œ≠ŒΩœÑœÅŒø ŒöŒ±ŒªŒ±Œ≤œÅœçœÑœâŒΩ üéø"},
  makellaria:{en:"Holy Monastery of Makellaria ‚õ™", el:"ŒôŒµœÅŒ¨ ŒúŒøŒΩŒÆ ŒúŒ±Œ∫ŒµŒªŒªŒ±œÅŒπŒ¨œÇ ‚õ™"},
  tower:{en:"Petmezai Tower üè∞", el:"Œ†œçœÅŒ≥ŒøœÇ Œ†ŒµœÑŒºŒµŒ∂Œ±ŒØœâŒΩ üè∞"},
  gorge:{en:"Vouraikos Gorge üèûÔ∏è", el:"Œ¶Œ±œÅŒ¨Œ≥Œ≥Œπ œÑŒøœÖ ŒíŒøœÖœÅŒ±œäŒ∫Œøœç üèûÔ∏è"},
  square:{en:"Petmezai Square üèûÔ∏è", el:"Œ†ŒªŒ±œÑŒµŒØŒ± Œ†ŒµœÑŒºŒµŒ∂Œ±ŒØœâŒΩ üèûÔ∏è"}
};

/* season layouts */
const LAYOUTS = {
  winter:{ s1:['museum','agialavra','square'], s2:['hill','heroes','ski','odontotos'], s3:['cave','gorge','makellaria','tower'] },
  spring:{ s1:['museum','agialavra','square'], s2:['hill','heroes','odontotos'],     s3:['gorge','cave','makellaria','tower','ski'] },
  summer:{ s1:['museum','agialavra','square'], s2:['hill','heroes','odontotos'],     s3:['gorge','cave','makellaria','tower','ski'] },
  autumn:{ s1:['museum','agialavra','square'], s2:['hill','heroes','odontotos'],     s3:['gorge','cave','makellaria','tower','ski'] }
};

/* ========= store helpers ========= */
function loadStore(){ try{return JSON.parse(localStorage.getItem(LS_KEY)||'{}')}catch(e){return{}} }
function saveStore(o){ localStorage.setItem(LS_KEY, JSON.stringify(o||{})) }
function clearStore(){ localStorage.removeItem(LS_KEY); localStorage.removeItem(LS_VICTORY); }
function addDone(key){ const s=loadStore(); s.completed=Array.from(new Set([...(s.completed||[]), key])); saveStore(s); }

/* ========= slider (2..27) ========= */
const slides=Array.from({length:26},(_,i)=>`public/photos/${i+2}.png`);
let sidx=0,timer; const heroImg=document.getElementById('heroImg'), frame=document.getElementById('heroFrame');
function show(n){ sidx=(n+slides.length)%slides.length; heroImg.style.opacity=0;
  setTimeout(()=>{ heroImg.src=slides[sidx]; heroImg.onload=()=>heroImg.style.opacity=1; },180); }
function start(){ timer=setInterval(()=>show(sidx+1),4000) } function stop(){ clearInterval(timer) }
document.getElementById('prevBtn').onclick=()=>{stop();show(sidx-1);start()};
document.getElementById('nextBtn').onclick=()=>{stop();show(sidx+1);start()};
frame.onmouseenter=stop; frame.onmouseleave=start; show(0); start();

/* ========= season & language ========= */
const seasonSelect=document.getElementById('seasonSelect');
const seasonNote=document.getElementById('seasonNote');
const langSelect=document.getElementById('langSelect');

function autoSeason(){
  const m=new Date().getMonth()+1;
  if(m===12||m<=3) return 'winter';
  if(m<=5) return 'spring';
  if(m<=9) return 'summer';
  return 'autumn';
}
function effectiveSeason(){
  const set=localStorage.getItem(LS_SEASON)||'auto';
  return set==='auto'?autoSeason():set;
}
function applySeasonNote(){
  const eff=effectiveSeason(), lang=currentLang();
  const key= eff==='winter'?'note.winter' : eff==='summer'?'note.summer' : eff==='spring'?'note.spring':'note.autumn';
  seasonNote.innerHTML=T[lang][key];
}
function currentLang(){ return localStorage.getItem(LS_LANG)||'en'; }
function applyLangToDom(){
  const lang=currentLang();
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k=el.getAttribute('data-i18n'); const txt=T[lang][k]; if(txt) el.innerHTML=txt;
  });
  document.getElementById('s1PostUrl').placeholder = lang==='el'?"ŒîŒ∑ŒºœåœÉŒπŒø link (œÄ.œá. Instagram)":"Public post URL (e.g. Instagram)";
  document.getElementById('s1Qr').placeholder = lang==='el'?"QR Œ∫œâŒ¥ŒπŒ∫œåœÇ (placeholder)":"Enter QR code (placeholder)";
  document.getElementById('s2QrA').placeholder = lang==='el'?"QR Œ≥ŒπŒ± ŒöŒ±œÑŒ¨œÉœÑŒ∑ŒºŒ± 2A":"Enter QR code for Shop 2A";
  document.getElementById('s2QrB').placeholder = lang==='el'?"QR Œ≥ŒπŒ± ŒöŒ±œÑŒ¨œÉœÑŒ∑ŒºŒ± 2B":"Enter QR code for Shop 2B";
  const rail=document.getElementById('s2RailUrl'); if(rail) rail.placeholder = lang==='el'?"ŒîŒ∑ŒºœåœÉŒπŒø link œÜœâœÑŒøŒ≥œÅŒ±œÜŒØŒ±œÇ ŒºŒµ #myhappybox":"Public photo URL with #myhappybox";
  document.getElementById('s3QrA').placeholder = lang==='el'?"QR Œ≥ŒπŒ± ŒöŒ±œÑŒ¨œÉœÑŒ∑ŒºŒ± 3A":"QR for Shop 3A";
  document.getElementById('s3QrB').placeholder = lang==='el'?"QR Œ≥ŒπŒ± ŒöŒ±œÑŒ¨œÉœÑŒ∑ŒºŒ± 3B":"QR for Shop 3B";
  document.getElementById('s3QrC').placeholder = lang==='el'?"QR Œ≥ŒπŒ± ŒöŒ±œÑŒ¨œÉœÑŒ∑ŒºŒ± 3C":"QR for Shop 3C";
}

/* ========= dynamic attractions UI ========= */
// ===== shop verify handlers =====
document.getElementById('s1QrBtn')?.addEventListener('click', ()=>{
  const code = document.getElementById('s1QrC').value.trim();
  const status = document.getElementById('s1QrStatus');
  verifyQR('s1', code, status);
});

document.getElementById('s2QrBtn')?.addEventListener('click', ()=>{
  const code = document.getElementById('s2QrC').value.trim();
  const status = document.getElementById('s2QrStatus');
  verifyQR('s2', code, status);
});

document.getElementById('s3QrBtn')?.addEventListener('click', ()=>{
  const code = document.getElementById('s3QrC').value.trim();
  const status = document.getElementById('s3QrStatus');
  verifyQR('s3', code, status);
});
const s1AttrList=document.getElementById('s1AttrList');
const s2AttrList=document.getElementById('s2AttrList');
const s3AttrList=document.getElementById('s3AttrList');

function makeCheckbox(id,label){
  const wrap=document.createElement('label');
  const cb=document.createElement('input'); cb.type='checkbox'; cb.id=id;
  wrap.appendChild(cb); wrap.appendChild(document.createTextNode(' '+label));
  return wrap;
}
function renderAttractions(){
  const lang=currentLang(), eff=effectiveSeason(), layout=LAYOUTS[eff];
  s1AttrList.innerHTML=''; s2AttrList.innerHTML=''; s3AttrList.innerHTML='';
  layout.s1.forEach(k=>{ s1AttrList.appendChild(makeCheckbox('s1_'+k, ATTR[k][lang])); });
  layout.s2.forEach(k=>{
    if(k==='hill'){
      const col=document.createElement('div'); col.style.display='flex'; col.style.flexDirection='column'; col.style.gap='6px';
      col.appendChild(makeCheckbox('s2_hill', ATTR.hill[lang]));
      const btn=document.createElement('button'); btn.className='btn'; btn.id='s2GeoBtn'; btn.textContent=(lang==='el'?'ŒàŒªŒµŒ≥œáŒøœÇ œÑŒøœÄŒøŒ∏ŒµœÉŒØŒ±œÇ':'Verify my location');
      col.appendChild(btn); s2AttrList.appendChild(col);
    }else if(k==='odontotos'){
      const col=document.createElement('div'); col.style.display='flex'; col.style.flexDirection='column'; col.style.gap='6px'; col.style.flex='1';
      col.appendChild(makeCheckbox('s2_odontotos', ATTR.odontotos[lang]));
      const row=document.createElement('div'); row.className='row';
      const input=document.createElement('input'); input.type='text'; input.id='s2RailUrl';
      input.placeholder=(lang==='el'?'ŒîŒ∑ŒºœåœÉŒπŒø link œÜœâœÑŒøŒ≥œÅŒ±œÜŒØŒ±œÇ ŒºŒµ #myhappybox':'Public photo URL with #myhappybox');
      const btn=document.createElement('button'); btn.className='btn ghost'; btn.id='s2RailBtn'; btn.textContent=(lang==='el'?'Œ•œÄŒøŒ≤ŒøŒªŒÆ link':'Submit URL');
      row.appendChild(input); row.appendChild(btn); col.appendChild(row); s2AttrList.appendChild(col);
    }else{
      s2AttrList.appendChild(makeCheckbox('s2_'+k, ATTR[k][lang]));
    }
  });
  layout.s3.forEach(k=>{ s3AttrList.appendChild(makeCheckbox('s3_'+k, ATTR[k][lang])); });
}

/* ========= state & progress ========= */
const st1El=document.getElementById('stStep1'), st2El=document.getElementById('stStep2'), st3El=document.getElementById('stStep3');
const barFill=document.getElementById('barFill'), stageNum=document.getElementById('stageNum'), stageHint=document.getElementById('stageHint');
const pills=document.getElementById('progressPills'), tierLine=document.getElementById('tierLine');
const overallFill=document.getElementById('overallFill'), overallPct=document.getElementById('overallPct');

function getState(){
  const done=new Set((loadStore().completed)||[]);
  const eff=effectiveSeason(), layout=LAYOUTS[eff];
  const s1Attrs=layout.s1.map(k=>'s1:attr:'+k);
  const s1={ post:done.has('s1:post'), shop:done.has('s1:shop'), attrOk:s1Attrs.some(k=>done.has(k)) };
  const s1ok=s1.post&&s1.shop&&s1.attrOk;
  const s2Attrs=layout.s2.map(k=>'s2:attr:'+k);
  const s2={ shopA:done.has('s2:shopA'), shopB:done.has('s2:shopB'), attrOk:s1ok&&s2Attrs.some(k=>done.has(k)) };
  const s2ok=s1ok&&s2.shopA&&s2.shopB&&s2.attrOk;
  const s3Attrs=layout.s3.map(k=>'s3:attr:'+k);
  const s3={ shopA:done.has('s3:shopA'), shopB:done.has('s3:shopB'), shopC:done.has('s3:shopC'), attrOk:s2ok&&s3Attrs.some(k=>done.has(k)) };
  const s3ok=s2ok&&s3.shopA&&s3.shopB&&s3.shopC&&s3.attrOk;

  const overallCount=(s1.post?1:0)+(s1.shop?1:0)+(s1.attrOk?1:0)+
                     (s2.shopA?1:0)+(s2.shopB?1:0)+(s2.attrOk?1:0)+
                     (s3.shopA?1:0)+(s3.shopB?1:0)+(s3.shopC?1:0)+(s3.attrOk?1:0);
  let stage=1; if(s1ok) stage=2; if(s2ok) stage=3;

  const tier = s3ok ? 'Legendary'
             : s2ok ? 'Rare ‚Üí Ultra Rare'
             : s1ok ? 'Common ‚Üí Uncommon'
             : '‚Äî';

  return {done, s1, s2, s3, s1ok, s2ok, s3ok, stage, overallCount, tier, layout};
}
function pill(text){ const el=document.createElement('span'); el.className='pill ok'; el.textContent=text; return el; }

function render(){
  const lang=currentLang(); const st=getState();
  st1El.classList.toggle('done', st.s1ok);
  st2El.classList.toggle('done', st.s2ok);
  st3El.classList.toggle('done', st.s3ok);
  const trackerSteps=(st.s1ok?1:0)+(st.s2ok?1:0)+(st.s3ok?1:0);
  barFill.style.width=(trackerSteps/3*100)+'%';
  stageNum.textContent=st.stage;
  stageHint.textContent = st.stage===1
    ? (lang==='el'?'ŒüŒªŒøŒ∫ŒªŒÆœÅœâœÉŒµ œÑŒø Œ£œÑŒ¨Œ¥ŒπŒø 1 Œ≥ŒπŒ± ŒΩŒ± ŒæŒµŒ∫ŒªŒµŒπŒ¥œéœÉŒµŒπœÇ œÑŒø 2 ‚Äî œÉœÑœåœáŒµœÖœÉŒµ œÉŒµ œÉœÄŒ±ŒΩŒπœåœÑŒµœÅŒ± tiers.':'Finish Stage 1 to unlock Stage 2 ‚Äî and aim for rarer tiers.')
    : st.stage===2
      ? (lang==='el'?'ŒúœÄœÅŒ¨Œ≤Œø! ŒûŒµŒ∫ŒªŒµŒØŒ¥œâœÉŒµœÇ œÑŒø 2 ‚Äî ŒøŒªŒøŒ∫ŒªŒÆœÅœâœÉŒ≠ œÑŒø Œ≥ŒπŒ± ŒΩŒ± œÄŒ±œÇ œÉœÑŒø 3.':'Great! Stage 2 unlocked ‚Äî complete it to reach Stage 3.')
      : (lang==='el'?'Œ§ŒµŒªŒπŒ∫ŒÆ ŒµœÖŒ∏ŒµŒØŒ±! ŒüŒªŒøŒ∫ŒªŒÆœÅœâœÉŒµ œÑŒø 3 Œ≥ŒπŒ± Œ∫ŒøœÅœÖœÜŒ±ŒØŒø tier.':'Final stretch! Complete Stage 3 for the top tier.');
  document.getElementById('s2Card').style.display = st.s1ok ? '' : 'none';
  document.getElementById('s3Card').style.display = st.s2ok ? '' : 'none';
  pills.innerHTML=''; st.done.forEach(k=>pills.appendChild(pill(k)));
  const pct=Math.round(st.overallCount/10*100);
  overallFill.style.width=pct+'%'; overallPct.textContent=pct+'%';
  tierLine.textContent='Tier: '+st.tier;
  if(pct===100) triggerVictoryOnce();
}

/* ========= interactions ========= */
document.getElementById('s1PostBtn').onclick=()=>{
  const url=document.getElementById('s1PostUrl').value.trim();
  const stS=document.getElementById('s1PostStatus');
  if(!/^https?:\/\//i.test(url)){ stS.innerHTML='<span class="pill err">Paste a valid public URL</span>'; return; }
  if(!/#?myhappybox/i.test(url)){ stS.innerHTML='<span class="pill warn">Include #myhappybox</span>'; }
  addDone('s1:post'); stS.innerHTML='<span class="pill ok">Submitted</span>'; render();
};
document.getElementById('s1QrBtn').onclick=()=>{
  const code=(document.getElementById('s1Qr').value||'').trim().toUpperCase();
  const stS=document.getElementById('s1QrStatus');
  if(!code){ stS.innerHTML='<span class="pill err">Enter code</span>'; return; }
  addDone('s1:shop'); stS.innerHTML='<span class="pill ok">QR verified</span>'; render();
};
document.getElementById('s1AttrBtn').onclick=()=>{
  const eff=effectiveSeason(), layout=LAYOUTS[eff].s1;
  const stS=document.getElementById('s1AttrStatus'); let picked=false;
  layout.forEach(k=>{ const cb=document.getElementById('s1_'+k); if(cb&&cb.checked){ addDone('s1:attr:'+k); picked=true; }});
  stS.innerHTML=picked?'<span class="pill ok">Marked</span>':'<span class="pill warn">Pick at least one</span>'; render();
};

document.getElementById('s2QrBtn').onclick=()=>{
  const a=document.getElementById('s2QrA').value.trim().toUpperCase();
  const b=document.getElementById('s2QrB').value.trim().toUpperCase();
  const stS=document.getElementById('s2QrStatus');
  const G=getState(); if(!G.s1ok){ stS.innerHTML='<span class="pill warn">Complete Stage 1 first</span>'; return; }
  if(!a||!b){ stS.innerHTML='<span class="pill err">Enter both codes</span>'; return; }
  addDone('s2:shopA'); addDone('s2:shopB'); stS.innerHTML='<span class="pill ok">Both verified</span>'; render();
};

document.addEventListener('click',(e)=>{
  if(e.target && e.target.id==='s2GeoBtn'){
    const stS=document.getElementById('s2AttrStatus'); const G=getState();
    if(!G.s1ok){ stS.innerHTML='<span class="pill warn">Complete Stage 1 first</span>'; return; }
    if(!navigator.geolocation){ stS.innerHTML='<span class="pill err">Geolocation not supported</span>'; return; }
    stS.textContent='Checking‚Ä¶';
    const HILL={lat:38.04952, lng:22.11163};
    navigator.geolocation.getCurrentPosition(pos=>{
      const d=haversine(pos.coords.latitude,pos.coords.longitude,HILL.lat,HILL.lng);
      if(d<=0.25){ addDone('s2:attr:hill'); stS.innerHTML='<span class="pill ok">Hill verified</span>'; render(); }
      else{ stS.innerHTML='<span class="pill warn">You seem too far (~'+d.toFixed(2)+' km)</span>'; }
    },err=>{ stS.innerHTML='<span class="pill err">'+err.message+'</span>'; },{enableHighAccuracy:true,timeout:15000});
  }
  if(e.target && e.target.id==='s2RailBtn'){
    const url=(document.getElementById('s2RailUrl')||{value:''}).value.trim();
    const stS=document.getElementById('s2AttrStatus'); const G=getState();
    if(!G.s1ok){ stS.innerHTML='<span class="pill warn">Complete Stage 1 first</span>'; return; }
    if(!/^https?:\/\//i.test(url)){ stS.innerHTML='<span class="pill err">Paste a valid public URL</span>'; return; }
    if(!/#?myhappybox/i.test(url)){ stS.innerHTML='<span class="pill warn">Include #myhappybox</span>'; }
    addDone('s2:attr:odontotos'); stS.innerHTML='<span class="pill ok">Odontotos submitted</span>'; render();
  }
});
document.getElementById('s2AttrBtn').onclick=()=>{
  const eff=effectiveSeason(), layout=LAYOUTS[eff].s2; const stS=document.getElementById('s2AttrStatus'); let picked=false;
  layout.forEach(k=>{ const cb=document.getElementById('s2_'+k); if(cb&&cb.checked){ addDone('s2:attr:'+k); picked=true; }});
  stS.innerHTML=picked?'<span class="pill ok">Marked</span>':'<span class="pill warn">Select at least one</span>'; render();
};

document.getElementById('s3QrBtn').onclick=()=>{
  const a=document.getElementById('s3QrA').value.trim().toUpperCase();
  const b=document.getElementById('s3QrB').value.trim().toUpperCase();
  const c=document.getElementById('s3QrC').value.trim().toUpperCase();
  const stS=document.getElementById('s3QrStatus'); const G=getState();
  if(!G.s2ok){ stS.innerHTML='<span class="pill warn">Complete Stage 2 first</span>'; return; }
  if(!a||!b||!c){ stS.innerHTML='<span class="pill err">Enter all three codes</span>'; return; }
  addDone('s3:shopA'); addDone('s3:shopB'); addDone('s3:shopC'); stS.innerHTML='<span class="pill ok">Verified</span>'; render();
};
document.getElementById('s3AttrBtn').onclick=()=>{
  const eff=effectiveSeason(), layout=LAYOUTS[eff].s3; const stS=document.getElementById('s3AttrStatus'); let picked=false;
  layout.forEach(k=>{ const cb=document.getElementById('s3_'+k); if(cb&&cb.checked){ addDone('s3:attr:'+k); picked=true; }});
  stS.innerHTML=picked?'<span class="pill ok">Marked</span>':'<span class="pill warn">Pick at least one</span>'; render();
};

/* ====== CLAIM MODAL & EMAIL MINT ====== */
const modal=document.getElementById('modal');
document.getElementById('mintInfoBtn').onclick=()=>openClaimInfo(false);
document.getElementById('claimBtn').onclick=()=>openClaimInfo(true);
document.getElementById('closeModal').onclick=()=>modal.classList.remove('show');
modal.onclick=(e)=>{ if(e.target===modal) modal.classList.remove('show'); };

function openClaimInfo(showMint){
  const lang=currentLang(); const G=getState(); const body=document.getElementById('modalBody');
  document.getElementById('modalTitle').textContent = T[lang]["mint.title"];
  if(!G.s1ok){
    body.innerHTML=`
      <p>${T[lang]["claim.needS1"]}</p>
      <ul style="text-align:left;line-height:1.5">
        <li>${T[lang]["bullet.post"]}</li>
        <li>${T[lang]["bullet.shop1"]}</li>
        <li>${T[lang]["bullet.s1attr"]}</li>
      </ul>
      <p>${T[lang]["claim.points"]}</p>
    `;
  } else {
    const tierTxt = (G.tier==='‚Äî' ? (lang==='el'?'Common ‚Üí Uncommon':'Common ‚Üí Uncommon') : G.tier);
    body.innerHTML=`
      <p>${T[lang]["mint.cta"].replace('{tier}', tierTxt)}</p>
      <div class="row" style="margin-top:10px">
        <label for="mintEmail" style="min-width:160px;text-align:left">${T[lang]["mint.emailLabel"]}</label>
        <input type="email" id="mintEmail" placeholder="${T[lang]["mint.emailPlaceholder"]}" />
      </div>
      <div class="row">
        <button class="btn" id="doMintBtn">${T[lang]["btn.mintNow"]}</button>
      </div>
      <div class="status" id="mintStatus"></div>
      <p class="mini">${T[lang]["claim.mini"]}</p>
    `;
    document.getElementById('doMintBtn').onclick=handleMint;
  }
  modal.classList.add('show');
}
function isValidEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }
async function handleMint(){
  const lang=currentLang(); const email=(document.getElementById('mintEmail').value||'').trim();
  const mintStatus=document.getElementById('mintStatus'); const btn=document.getElementById('doMintBtn');
  if(!isValidEmail(email)){ mintStatus.innerHTML='<span class="pill err">Invalid email</span>'; return; }
  const G=getState();
  btn.classList.add('disabled'); btn.disabled=true;
  mintStatus.textContent=T[lang]["mint.sending"];
  try{
    const payload={
      email,
      tier:G.tier,
      stage:G.stage,
      completed:Array.from(G.done||[])
    };
    const resp=await fetch('/api/mint',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(!resp.ok) throw new Error('HTTP '+resp.status);
    mintStatus.innerHTML='<span class="pill ok">'+T[lang]["mint.success"]+'</span>';
  }catch(err){
    mintStatus.innerHTML='<span class="pill err">'+T[lang]["mint.error"]+'</span>';
  }finally{
    btn.classList.remove('disabled'); btn.disabled=false;
  }
}

/* overall render cycle */
function renderAll(){ applyLangToDom(); applySeasonNote(); renderAttractions(); render(); }

/* reset */
document.getElementById('resetBtn').onclick=()=>{ clearStore(); render(); };

/* lang + season init & handlers */
langSelect.value=localStorage.getItem(LS_LANG)||'en';
langSelect.addEventListener('change',()=>{ localStorage.setItem(LS_LANG,langSelect.value); renderAll(); });
seasonSelect.value=localStorage.getItem(LS_SEASON)||'auto';
seasonSelect.addEventListener('change',()=>{ localStorage.setItem(LS_SEASON,seasonSelect.value); renderAll(); });

/* utils */
function haversine(lat1,lon1,lat2,lon2){
  const R=6371, toRad=x=>x*Math.PI/180;
  const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
  const a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

/* Victory celebration */
const victoryEl=document.getElementById('victory'); const victoryClose=document.getElementById('victoryClose'); const confettiFx=document.getElementById('confettiFx');
function triggerVictoryOnce(){ if(localStorage.getItem(LS_VICTORY)==='yes') return; localStorage.setItem(LS_VICTORY,'yes'); showVictory(); }
function showVictory(){
  confettiFx.innerHTML=''; const colors=['#ff7a00','#ffb84d','#ffd699','#27c498','#5aa9e6','#d16ba5']; const pieces=80;
  for(let i=0;i<pieces;i++){ const s=document.createElement('span'); s.className='piece'; s.style.left=Math.random()*100+'%'; s.style.top=(-Math.random()*40)+'vh';
    s.style.background=colors[i%colors.length]; s.style.animationDuration=(0.9+Math.random()*0.7)+'s'; s.style.transform=`rotate(${Math.random()*360}deg)`; confettiFx.appendChild(s); }
  victoryEl.classList.add('show'); setTimeout(()=>{ if(victoryEl.classList.contains('show')) victoryEl.classList.remove('show'); },4000);
}
victoryClose.onclick=()=>victoryEl.classList.remove('show');
victoryEl.onclick=(e)=>{ if(e.target===victoryEl) victoryEl.classList.remove('show'); };

/* first paint */
renderAll();
</script>
</body>
</html>
